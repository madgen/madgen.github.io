<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-41394820-3"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-41394820-3');
        </script>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="description" content="Mistral Contrastin's thought bubble,
          blog, and personal revelations." />
        <meta name="author" content="Mistral Contrastin" />
        <title>Do disturb me | Typed Programs Don't Leak Data</title>
        <link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet" />
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
        <link rel="alternate" type="application/atom+xml" href="../atom.xml" />

        <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png" />
        <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png" />
    </head>
    <body>
        <div id="header">
            <div class="top-container">
              <div id="logo">
                  <a href="../">Do Disturb Me</a>
              </div>
              <div id="navigation">
                  <a href="../archive.html">Blog</a>
                  <a href="../teaching.html">Teaching</a>
              </div>
            </div>
            <div id="mandelbrot"></div>
        </div>

        <div id="content">
            <div class="info">
  Posted on June 27, 2021
  
  
    and last updated on June 27, 2021
  
</div>

<h1>Typed Programs Don't Leak Data</h1>


<p class="in-which">In which we turn privacy violations into compile-time errors in a simple imperative language embedded in Haskell and enforce it in style using GADTs.</p>


<div class="post"><p>Private data should remain private. The goal is obvious, but how to achieve it is less so.</p>
<p>For one thing, it is a fundamentally global problem. Private data can enter a system through a fancy frontend, make its way deep through the maze of backend services, only to be logged and read by someone who is not supposed to. It is not practical for people to audit a large system end-to-end and even less realistic to expect such an audit to hold up against software evolution.</p>
<p>Further, privacy as a property is not always amenable to testing. The most <em>explicit</em> cases of leakage such as</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1">publicStatus <span class="op">:=</span> privateMaritalStatus</a></code></pre></div>
<p>can perhaps be tested, but how about the more <em>implicit</em> forms of leakage. Consider</p>
<pre><code>if (privateMaritalStatus = &quot;single&quot;) {
  publicStatus := &quot;available&quot;;
} else {
  publicStatus := &quot;complicated&quot;;
}</code></pre>
<p>where private marital status doesn’t physically move to the public status, but by observing the public status, we can figure something out about the private data. Without reifying these implicit flows at runtime, it doesn’t look like we can write tests.</p>
<p>The nightmare doesn’t end there. There are subtler ways of leaking data such as non-termination, execution time, and exceptions. Perhaps the most famous example is figuring out passwords by measuring the time it takes for a program to reject candidate passwords. The longer rejection takes, the longer password prefix can be deduced.</p>
<p>There are multitude of ways of mitigating these problems both dynamic and static. In this post, we focus on one productive static approach. Namely, we implement a type system that regulates explicit and implicit dataflows as well as non-termination as a covert channel. See <a href="#final-words">the end of this post</a> for references.</p>
<p>We won’t shy away from harnessing the full might of GHC. The necessary imports, extensions, and typechecker plugin can be found at <a href="#full-program">the end of this post</a> as well as <a href="https://github.com/madgen/volpano-smith">this repository</a>.</p>
<p>If you find a mistake, some explanation to be unclear, or just want to say hi, reach me on <a href="https://twitter.com/madgen_">Twitter</a> or by other ways listed on my homepage.</p>
<p>Let’s get started.</p>
<h2 id="a-simple-imperative-language">A simple imperative language</h2>
<p>We’ll use the most contrived language possible that demonstrates all the major ideas. First, we define everything using simple types that does not make use of any fancy type machinery.</p>
<p>The expression language has integer literals, variables, and addition.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">data</span> <span class="dt">Variable</span> <span class="fu">=</span> <span class="dt">Variable</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">infixr</span> <span class="dv">6</span> <span class="fu">:+</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="kw">data</span> <span class="dt">Exp</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="dt">EInt</span><span class="ot"> ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Exp</span></a>
<a class="sourceLine" id="cb3-6" title="6">  <span class="dt">EVar</span><span class="ot"> ::</span> <span class="dt">Variable</span> <span class="ot">-&gt;</span> <span class="dt">Exp</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="ot">  (:+) ::</span> <span class="dt">Exp</span> <span class="ot">-&gt;</span> <span class="dt">Exp</span> <span class="ot">-&gt;</span> <span class="dt">Exp</span></a></code></pre></div>
<p>The tiny imperative language has assignments, sequencing, if-then-else statements, and while loops.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">infixl</span> <span class="dv">5</span> <span class="fu">:=</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">infixl</span> <span class="dv">4</span> <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">data</span> <span class="dt">Cmd</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="ot">  (:=)  ::</span> <span class="dt">Variable</span> <span class="ot">-&gt;</span> <span class="dt">Exp</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="ot">  (:&gt;&gt;) ::</span> <span class="dt">Cmd</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span></a>
<a class="sourceLine" id="cb4-6" title="6">  <span class="dt">ITE</span><span class="ot">   ::</span> <span class="dt">Exp</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span></a>
<a class="sourceLine" id="cb4-7" title="7">  <span class="dt">While</span><span class="ot"> ::</span> <span class="dt">Exp</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span></a>
<a class="sourceLine" id="cb4-8" title="8"></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="kw">newtype</span> <span class="dt">Program</span> <span class="fu">=</span> <span class="dt">Program</span> <span class="dt">Cmd</span></a></code></pre></div>
<p>Here’s a simple program in this language</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" title="1"><span class="ot">simpleProgram ::</span> <span class="dt">Program</span></a>
<a class="sourceLine" id="cb5-2" title="2">simpleProgram <span class="fu">=</span> <span class="dt">Program</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb5-3" title="3">  x <span class="fu">:=</span> <span class="dt">EInt</span> <span class="dv">42</span> <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="dt">ITE</span> (<span class="dt">EVar</span> x)</a>
<a class="sourceLine" id="cb5-5" title="5">    (<span class="dt">While</span> (<span class="dt">EVar</span> y) <span class="fu">$</span></a>
<a class="sourceLine" id="cb5-6" title="6">      y <span class="fu">:=</span> <span class="dt">EVar</span> y <span class="fu">:+</span> <span class="dt">EInt</span> (<span class="fu">-</span><span class="dv">1</span>) <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb5-7" title="7">      x <span class="fu">:=</span> <span class="dt">EVar</span> x <span class="fu">:+</span> <span class="dt">EInt</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-8" title="8">    (y <span class="fu">:=</span> <span class="dt">EInt</span> <span class="dv">24</span>)</a>
<a class="sourceLine" id="cb5-9" title="9">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb5-10" title="10">  x <span class="fu">=</span> <span class="dt">Variable</span> <span class="st">&quot;x&quot;</span></a>
<a class="sourceLine" id="cb5-11" title="11">  y <span class="fu">=</span> <span class="dt">Variable</span> <span class="st">&quot;y&quot;</span></a></code></pre></div>
<p>In more traditional syntax, this program corresponds to the following:</p>
<pre><code>x := 42;
if (x) {
  while (y) {
    y := y - 1;
    x := x + 1;
  }
} else {
  y := 24;
}</code></pre>
<p>At this point, we should write an evaluator function to give dynamic semantics to this language, but there is nothing interesting about it. So, we’ll skip it. The intuitive evaluation of the language is the right one. The only oddity is that we treat <code>0</code> as false and any other number as true when an expression is used as a condition.</p>
<h2 id="typing-our-language">Typing our language</h2>
<p>Now that we are acquainted with the language, let’s prevent private data from leaking.</p>
<h3 id="security-levels">Security levels</h3>
<p>We need to distinguish private from public. We’ll use natural numbers to do that. The higher the value, the more private it is. All variables in our language have intrinsic security levels reflected in their types.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">type</span> <span class="dt">Level</span> <span class="fu">=</span> <span class="dt">Nat</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">newtype</span> <span class="dt">Variable</span> (<span class="ot">l ::</span> <span class="dt">Level</span>) <span class="fu">=</span> <span class="dt">Variable</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="ot">public ::</span> <span class="dt">Variable</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb7-6" title="6">public <span class="fu">=</span> <span class="dt">Variable</span> <span class="st">&quot;public&quot;</span></a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="ot">private ::</span> <span class="dt">Variable</span> <span class="dv">999</span></a>
<a class="sourceLine" id="cb7-9" title="9">private <span class="fu">=</span> <span class="dt">Variable</span> <span class="st">&quot;private&quot;</span></a></code></pre></div>
<h3 id="expressions">Expressions</h3>
<p>The expression language is structurally the same as the simply typed version, but expression types now reflect how private expressions are.</p>
<p>For variable expressions, the obvious choice is to use the security level of the underlying variable. The literals are all be public, i.e., they all have the security level 0. Finally, for plus, we’ll be conservative and pick the more private security level. A folder that contains some top secret intelligence and a pizzaria flyer cannot be handed to a pizza lover without security clearance.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">infixr</span> <span class="dv">6</span> <span class="fu">:+</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">data</span> <span class="dt">Exp</span> (<span class="ot">level ::</span> <span class="dt">Level</span>) <span class="kw">where</span></a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="dt">EInt</span><span class="ot"> ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Exp</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="dt">EVar</span><span class="ot"> ::</span> <span class="dt">Variable</span> level <span class="ot">-&gt;</span> <span class="dt">Exp</span> level</a>
<a class="sourceLine" id="cb8-5" title="5"><span class="ot">  (:+) ::</span> <span class="dt">Exp</span> level1 <span class="ot">-&gt;</span> <span class="dt">Exp</span> level2 <span class="ot">-&gt;</span> <span class="dt">Exp</span> (<span class="dt">Max</span> level1 level2)</a></code></pre></div>
<p>Another way of writing these constructors would be using inference rules. <code>e : l</code> means <code>e</code> has a security level <code>l</code> and <code>v : l</code> means the intrinsic security level of the variable <code>v</code> is <code>l</code>.</p>
<pre><code>  ----------
  EInt n : 0

    v : l
  ----------
  EVar v : l

  e1 : l1      e2 : l2
  --------------------
  e1 :+ e2 : max l1 l2</code></pre>
<p>Here’s a simple expression where GHC does the maximum computation for us behind the scenes.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" title="1"><span class="ot">compoundPrivateExp ::</span> <span class="dt">Exp</span> <span class="dv">999</span></a>
<a class="sourceLine" id="cb10-2" title="2">compoundPrivateExp <span class="fu">=</span> <span class="dt">EVar</span> public <span class="fu">:+</span> <span class="dt">EVar</span> private</a></code></pre></div>
<h3 id="commands">Commands</h3>
<p>Commands are where information flow happens and where our type system gets interesting. Before we go over each constructor, here’s the definition in all of its glory.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">infixl</span> <span class="dv">5</span> <span class="fu">:=</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">infixl</span> <span class="dv">4</span> <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="kw">data</span> <span class="dt">Cmd</span> (<span class="ot">level ::</span> <span class="dt">Level</span>) <span class="kw">where</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="ot">  (:=)  ::</span> (le <span class="fu">&lt;=</span> lv) <span class="ot">=&gt;</span> <span class="dt">Variable</span> lv <span class="ot">-&gt;</span> <span class="dt">Exp</span> le <span class="ot">-&gt;</span> <span class="dt">Cmd</span> lv</a>
<a class="sourceLine" id="cb11-5" title="5"><span class="ot">  (:&gt;&gt;) ::</span> <span class="dt">Cmd</span> l1 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l2 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> (<span class="dt">Min</span> l1 l2)</a>
<a class="sourceLine" id="cb11-6" title="6">  <span class="dt">ITE</span><span class="ot">   ::</span> (lb <span class="fu">&lt;=</span> <span class="dt">Min</span> l1 l2) <span class="ot">=&gt;</span> <span class="dt">Exp</span> lb <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l1 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l2 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> (<span class="dt">Min</span> l1 l2)</a>
<a class="sourceLine" id="cb11-7" title="7">  <span class="dt">While</span><span class="ot"> ::</span> (lb <span class="fu">&lt;=</span> l) <span class="ot">=&gt;</span> <span class="dt">Exp</span> lb <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l</a></code></pre></div>
<p>Structurally, this is identical to the simply typed commands. We have the same constructors with the same number of arguments. However, it is different in two major ways:</p>
<ol type="1">
<li>Each command now carries a security level. More precisely, they carry <strong>the security level of the most public variable that was assigned in the command</strong>. This will help us control implicit flows and covert channels, but exactly how will only become clear when we look at if-then-else statements.</li>
<li>Constructors for assignment, conditional, and while statements now require conditions on the security levels of their parameters.</li>
</ol>
<p>In the end, we don’t care about the security level of a command, it is only necessary to bar bad data flows. So it can be hidden away once we construct the program with the help of an existential type.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">data</span> <span class="dt">Program</span> <span class="fu">=</span> <span class="kw">forall</span> level<span class="fu">.</span> <span class="dt">Program</span> (<span class="dt">Cmd</span> level)</a></code></pre></div>
<p>We now go over each of these constructors one by one. Just as we did for expressions, we present the inference rule corresponding to each constructor. The judgement <code>c : l</code> means that the lowest security level that the command <code>c</code> assigns to is <code>l</code>.</p>
<h4 id="assignment">Assignment</h4>
<p>The assignment rule is fundamental because it is the only way in the language to leak data.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb13-1" title="1"><span class="ot">(:=) ::</span> (le <span class="fu">&lt;=</span> lv) <span class="ot">=&gt;</span> <span class="dt">Variable</span> lv <span class="ot">-&gt;</span> <span class="dt">Exp</span> le <span class="ot">-&gt;</span> <span class="dt">Cmd</span> lv</a></code></pre></div>
<p>The equivalent inference rule:</p>
<pre><code>  v : lv    e : le    le &lt;= lv
  -----------------------------
          v := e : lv</code></pre>
<p>An assignment only assigns to one variable, so the most public variable it assigns to is that variable. To construct an assignment at all, the expression must be less private than the assigned variable.</p>
<p>This is enough to ban all private data leaking through explicit flows. For example, the following program is fine because <code>public</code> has a lower security level (i.e., more public) than <code>private</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb15-1" title="1">simpleAssignmentOK <span class="fu">=</span> <span class="dt">Program</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb15-2" title="2">  private <span class="fu">:=</span> <span class="dt">EVar</span> public</a></code></pre></div>
<p>However, if we attempt to go in the other direction, we’ll get a type error.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb16-1" title="1">simpleAssignmentKO <span class="fu">=</span> <span class="dt">Program</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb16-2" title="2">  public <span class="fu">:=</span> <span class="dt">EVar</span> private</a></code></pre></div>
<p>Particularly, GHC has the following to say about this program:</p>
<pre><code>Couldn't match type ‘'False’ with ‘'True’ arising from a use of ‘:=’</code></pre>
<p>I grant you that this is not the most obvious error message. But at least we have a compile-time error instead of leaking private data! Substituting the security levels, we have <code>999 &lt;= 0</code> which is a shorthand for <code>999 &lt;=?  0 ~ True</code> and GHC simplifies <code>999 &lt;=? 0</code> to <code>False</code>. This is why the error message says <code>False</code> and <code>True</code> do not match.</p>
<h4 id="sequencing">Sequencing</h4>
<p>The most public variable assigned in a sequence of two commands of course belongs to the subcommand that has the more public assignment in it.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb18-1" title="1"><span class="ot">(:&gt;&gt;) ::</span> <span class="dt">Cmd</span> l1 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l2 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> (<span class="dt">Min</span> l1 l2)</a></code></pre></div>
<p>The equivalent inference rule:</p>
<pre><code>  c1 : l1       c2 : l2
  ---------------------
  c1 :&gt;&gt; c2 : Min l1 l2</code></pre>
<p>Two commands in sequence are well-typed if and only if both of the subcommands are well-typed. For example, the following sequence of two assignments is alright.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb20-1" title="1">tempAssignmentOK <span class="fu">=</span> <span class="dt">Program</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb20-2" title="2">  temp <span class="fu">:=</span> <span class="dt">EVar</span> public <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb20-3" title="3">  private <span class="fu">:=</span> <span class="dt">EVar</span> temp</a>
<a class="sourceLine" id="cb20-4" title="4">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb20-5" title="5">  temp <span class="fu">=</span> <span class="dt">Variable</span> <span class="fu">@</span><span class="dv">5</span> <span class="st">&quot;temp&quot;</span></a></code></pre></div>
<p>The security level of the assignments are <code>Min 5 0</code> and <code>Min 999 5</code>, so the overall security level for the sequenced command is <code>Min 0 5</code> which is just <code>0</code>, i.e., the security level of <code>public</code>.</p>
<h4 id="if-then-else">If-then-else</h4>
<p>It is time to tackle the more mysterious implicit flows that happen as a result of a conditional write to some public data based on a private one.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb21-1" title="1"><span class="dt">ITE</span><span class="ot"> ::</span> (lb <span class="fu">&lt;=</span> <span class="dt">Min</span> l1 l2) <span class="ot">=&gt;</span> <span class="dt">Exp</span> lb <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l1 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l2 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> (<span class="dt">Min</span> l1 l2)</a></code></pre></div>
<p>The equivalent inference rule:</p>
<pre><code>           e : lb
          c1 : l1
          c2 : l2
      lb &lt;= Min l1 l2
  -----------------------
  ITE e c1 c2 : Min l1 l2</code></pre>
<p>The reasoning for the overall security level of a conditional statement is same as that for sequencing. The most public level assigned in the overall statement must come from the more public subcommand. Unlike sequencing, we know that only one of the branches will be taken but we cannot know which one at compile time, so we pessimistically account for both cases.</p>
<p>This rule also comes with a requirement that needs to be satisfied. The security level of the conditional expression (<code>lb</code>) must be less than those of both branches (<code>l1</code> and <code>l2</code>). This prevents implicit flows and explains why we carry the security level of the most public security level commands assign to. If the security level of the condition was higher than the lowest level assigned in one of the branches, then a more public variable’s value would be in part determined by a private one. Thus, by observing the more public value, we could deduce something about the private value. However, the condition ensures that only more public data can influence private data. This is safe because whoever has access to the more private data would also have access to the public one.</p>
<p>The explanation is a mouthful, but examples make the point clearer.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb23-1" title="1">implicitPublicFlowOK <span class="fu">=</span> <span class="dt">Program</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb23-2" title="2">  <span class="dt">ITE</span> (<span class="dt">EVar</span> public)</a>
<a class="sourceLine" id="cb23-3" title="3">    (public <span class="fu">:=</span> <span class="dt">EInt</span> <span class="dv">42</span>)</a>
<a class="sourceLine" id="cb23-4" title="4">    (private <span class="fu">:=</span> <span class="dt">EVar</span> public)</a></code></pre></div>
<p>The conditional expression in this program is public. In the then branch, we assign to <code>public</code> which is always safe. In the else branch, we assign to <code>private</code>, but this too is fine because if we are allowed to observe <code>private</code>, we can only make a conclusion about <code>public</code> which we are allowed inspect in full anyway.</p>
<p>A similar program with the conditional expression changed to <code>private</code>, on the other hand, fails with the same <code>False</code> is not <code>True</code> error:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb24-1" title="1">implicitPrivateFlowKO <span class="fu">=</span> <span class="dt">Program</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb24-2" title="2">  <span class="dt">ITE</span> (<span class="dt">EVar</span> private)</a>
<a class="sourceLine" id="cb24-3" title="3">    (public <span class="fu">:=</span> <span class="dt">EInt</span> <span class="dv">42</span>)</a>
<a class="sourceLine" id="cb24-4" title="4">    (private <span class="fu">:=</span> <span class="dt">EVar</span> public)</a></code></pre></div>
<p>This program is ill-typed because <code>private</code> is more private than <code>public</code>. We can easily justify this ban. Otherwise, if we observed the value of <code>public</code> not to be <code>42</code>, we could deduce that the else branch is taken, and consequently, <code>private</code> must be non-zero. So by observing <code>public</code>, we would have leaked something about <code>private</code>.</p>
<p>The typing rule for if-then-else statements come with a limitation in expressiveness. It bans some programs that cannot leak private data.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb25-1" title="1">implicitPrivateFlowOKKO <span class="fu">=</span> <span class="dt">Program</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb25-2" title="2">  <span class="dt">ITE</span> (<span class="dt">EVar</span> private)</a>
<a class="sourceLine" id="cb25-3" title="3">    (public <span class="fu">:=</span> <span class="dt">EInt</span> <span class="dv">42</span>)</a>
<a class="sourceLine" id="cb25-4" title="4">    (public <span class="fu">:=</span> <span class="dt">EInt</span> <span class="dv">42</span>)</a></code></pre></div>
<p>This program is illegal according to our typing rules because there is an implicit flow from security level <code>999</code> to <code>0</code> (in two different ways in fact!), but this does not actually leak data. By observing the value of <code>public</code> after the program is executed, we cannot tell anything about <code>private</code> because the assignment to <code>public</code> is consistent in both branches.</p>
<p>This particular example looks easy to detect, but in general, it requires program equivalence which would make typechecking undecidable.</p>
<h4 id="while-loop">While loop</h4>
<p>Uncharacteristically, the while loop rule is simpler than the one for if-then-else statements.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb26-1" title="1"><span class="dt">While</span><span class="ot"> ::</span> (lb <span class="fu">&lt;=</span> l) <span class="ot">=&gt;</span> <span class="dt">Exp</span> lb <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l</a></code></pre></div>
<p>The equivalent inference rule:</p>
<pre><code>      e : lb
      c : l
     lb &lt;= l
  -------------
  While e c : l</code></pre>
<p>The minimum assignment level can only come from the only subcommand of the while loop.</p>
<p>The requirement for constructing a while loop is for the conditional expression’s security level to be more public than the most public level assigned in the loop body. The reasoning is precisely the same as the one for if-then-else statements.</p>
<p>Now that we have the while loop, let’s look at the least contrived program of this post. We halve an even natural number by looping.</p>
<p>Let’s first derive reusable increment and decrement operations. To do this we derive a generic <code>adder</code> first.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb28-1" title="1"><span class="ot">lemmaMax0 ::</span> <span class="dt">Max</span> level <span class="dv">0</span> <span class="fu">:~:</span> level</a>
<a class="sourceLine" id="cb28-2" title="2">lemmaMax0 <span class="fu">=</span> <span class="dt">Refl</span></a>
<a class="sourceLine" id="cb28-3" title="3"></a>
<a class="sourceLine" id="cb28-4" title="4"><span class="ot">adder ::</span> <span class="kw">forall</span> level<span class="fu">.</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Variable</span> level <span class="ot">-&gt;</span> <span class="dt">Cmd</span> level</a>
<a class="sourceLine" id="cb28-5" title="5">adder i var <span class="fu">|</span> <span class="dt">Refl</span> <span class="ot">&lt;-</span> lemmaMax0 <span class="fu">@</span>level <span class="fu">=</span> var <span class="fu">:=</span> <span class="dt">EVar</span> var <span class="fu">:+</span> <span class="dt">EInt</span> i</a></code></pre></div>
<p>This looks more complicated than one initially expects. The body of the adder is simple, we offset the given variable’s value with <code>i</code> and assign back to the variable. But what about that <code>lemmaMax0</code> and <code>Refl</code>? Long story short, the assignment in question does not have access to a concrete level, it works for any security level, so GHC has to do some symbolic reasoning.</p>
<p>In particular, GHC needs to prove that <code>Max level 0 &lt;= level</code>. This is always true, but not obvious to GHC. I prove a stronger property in <code>lemmaMax0</code>, namely <code>Max level 0</code> is exactly <code>level</code>. The proof is by reflexivity. Normally, GHC cannot recognise this proof on its own, so we’d need to teach it some arithmetic, but I felt lazy this weekend and added a typechecker plugin that lets GHC in on some basic arithmetic facts. Such plugins are incredible, but out of scope of this post. The plugin I used is <a href="https://github.com/clash-lang/ghc-typelits-extra">ghc-typelits-extra</a>.</p>
<p>Now that we have this lemma, I simply pattern match on it which simplifies the <code>Max level 0 &lt;= level</code> proof obligation to <code>level &lt;= level</code> and GHC is clever enough to work that one out.</p>
<p>After the small detour, the actual increment and decrement operations are trivial.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb29-1" title="1">inc,<span class="ot"> dec ::</span> <span class="dt">Variable</span> level <span class="ot">-&gt;</span> <span class="dt">Cmd</span> level</a>
<a class="sourceLine" id="cb29-2" title="2">inc <span class="fu">=</span> adder <span class="dv">1</span></a>
<a class="sourceLine" id="cb29-3" title="3">dec <span class="fu">=</span> adder (<span class="fu">-</span><span class="dv">1</span>)</a></code></pre></div>
<p>We are now ready to halve an even natural number stored in <code>privCounter</code> and store its value in <code>private</code>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb30-1" title="1">halveCovertKO <span class="fu">=</span> <span class="dt">Program</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb30-2" title="2">  finished <span class="fu">:=</span> <span class="dt">EInt</span> <span class="dv">0</span> <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb30-3" title="3">  private <span class="fu">:=</span> <span class="dt">EInt</span> <span class="dv">0</span> <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb30-4" title="4">  <span class="dt">While</span> (<span class="dt">EVar</span> privCounter)</a>
<a class="sourceLine" id="cb30-5" title="5">    (dec privCounter <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb30-6" title="6">     dec privCounter <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb30-7" title="7">     inc private) <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb30-8" title="8">  inc finished</a>
<a class="sourceLine" id="cb30-9" title="9">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb30-10" title="10">  finished <span class="fu">=</span> <span class="dt">Variable</span> <span class="fu">@</span><span class="dv">0</span> <span class="st">&quot;finished&quot;</span></a>
<a class="sourceLine" id="cb30-11" title="11">  privCounter <span class="fu">=</span> <span class="dt">Variable</span> <span class="fu">@</span><span class="dv">42</span> <span class="st">&quot;privCounter&quot;</span></a></code></pre></div>
<p>The conditional of the while loop is just as private as the variables incremented and decremented in its body. Hence, the program does not leak private data, or does it? 🤔</p>
<h2 id="plugging-covert-channels">Plugging covert channels</h2>
<p>The natural number halving program above does not leak data explicitly or implicitly, but it leaks some data through covert channels. We can observe that the program terminates because we can observe the value of <code>finished</code> which is public. Knowing that the program terminated leaks the fact that <code>privCounter</code>’s original value was either zero or even. We shouldn’t be able to deduce that since this counter is private whereas termination is public.</p>
<p>Fortunately, not all is lost. We can plug this covert channel with a minor modification to the while constructor.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb31-1" title="1"><span class="dt">While</span><span class="ot"> ::</span> <span class="dt">Exp</span> <span class="dv">0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l</a></code></pre></div>
<p>The equivalent inference rule:</p>
<pre><code>      e : 0
      c : l
  -------------
  While e c : l</code></pre>
<p>This change necessitates the loop’s conditional expression to be public. It also dispenses with the conditional expression being more public than the most public variable assigned in the body because this always holds when the conditional expression is public.</p>
<p>This easily bars the halving program because it both modifies private variables, but does it cover all cases of non-termination-based private data leakage? If the program terminates, we learn that the conditional expression hit zero. This only tells us about the data involved in that expression, so if all of that is public anyway, we cannot possibly leak data.</p>
<h3 id="expressivity">Expressivity</h3>
<p>This change, sadly, lands two more blows to expressivity.</p>
<p>First, if we initialise <code>privCounter</code> before the while loop to a positive even number, the program always terminates and the program cannot leak data. However, deducing this in general requires a solution to the halting problem.</p>
<p>Second, and more importantly, non-termination can only depend on public data. For example, if we extended our language with arrays and had an array of employees, we would wouldn’t be able to loop over employees if the number of employees was private.</p>
<p>Our saving grace is that we can get a lot done with terminating programs. Reassessing the employee example, if we extend our language with <code>foreach</code> and loop over the array directly, granted that we cannot make the array larger as we iterate over it, the loop would always terminate. Consequently, <code>foreach</code> admits a more permissive typing rule without compromising privacy through covert channels.</p>
<h2 id="final-words">Final words</h2>
<p>The language we considered here is simple, but the literature on type-based information-flow control is both wide and active. We already talked about how we can enrich the language with <code>foreach</code> and improve expressivity while being termination-sensitive. The same trick we used for while loops can also be applied to exceptions to prevent other covert channels. <a href="https://dl.acm.org/doi/10.1145/1929553.1929564">Language-Based Information-Flow Security</a> by Andrei Sabelfeld and Andrew Myers provide a good lay of the land. More specifically, <a href="https://ieeexplore.ieee.org/document/596807">Eliminating Covert Flows with Minimum Typings</a> by Volpano and Smith introduces termination-sensitive typing we presented as well as how to securely employ exceptions.</p>
<p>The ulterior motive of this post is to show off how seamless type-level programming in Haskell can be. At no point, I said “I wish I was using a proper dependently typed language” to myself. We even avoided reinventing arithmetic using a typechecker plugin. That topic clearly deserves a post of its own.</p>
<p>You might be bit disappointed if you’re a Haskell developer looking to employ static IFC in your code. One remedy might be the <a href="https://hackage.haskell.org/package/lio">LIO monad available in Hackage</a> which takes a similar approach but is dynamic. If you’re after no runtime cost, Chapter 6 of <a href="https://dl.acm.org/doi/10.1145/1929553.1929564">Information Flow Enforcement in Monadic Libraries</a> introduces a monad transformer in Haskell that employs the same ideas presented in this blog post to statically enforce information-flow properties.</p>
<p>The intuition presented in this blog post about why our type system is sound is no substitute for a proof. The most beautiful definition that captures the desired property is called <em>non-interference</em> which simply says private data does not interfere with public data in a formal manner. This definition is far reaching because it makes little reference to the dynamic semantics of the language. That too deserves a thorough treatment of its own. That and the proof can be found in <a href="https://core.ac.uk/download/pdf/36700757.pdf">A Sound Type System for Secure Flow Analysis</a> by Volpano, Irvine, and Smith. This is also the paper that introduced the type system we considered.</p>
<p>Finally and most importantly, the treatment of the type system in this chapter comes from the Chapter 9 of <a href="http://concrete-semantics.org">Concrete Semantics</a> by Tobias Nipkow and Gerwin Klein. Not only it is beautifully and inductively presented, but also the soundness proof of the type system is mechanised in Isabelle/HOL. All there was left for me was to translate it to Haskell using GADTs.</p>
<h2 id="inference-rules">Inference rules</h2>
<p>Quick reference for all the inference rules in this post.</p>
<p>Expressions:</p>
<pre><code>                         v : l              e1 : l1      e2 : l2
---------- int        ---------- var         -------------------- add
EInt n : 0            EVar v : l            e1 :+ e2 : max l1 l2</code></pre>
<p>Commands (termination-sensitive):</p>
<pre><code>
v : lv    e : le    le &lt;= lv             c1 : l1       c2 : l2
---------------------------- assign      --------------------- sequence
        v := e : lv                      c1 :&gt;&gt; c2 : Min l1 l2


        e : lb
c1 : l1         c2 : l2                            e : 0
    lb &lt;= Min l1 l2                                c : l
----------------------- if-then-else           ------------- while
ITE e c1 c2 : Min l1 l2                        While e c : l</code></pre>
<h2 id="full-program">Full program</h2>
<p>The full program can be found in <a href="https://github.com/madgen/volpano-smith">this repository</a>.</p>
<p>The GHC typechecker plugin, <a href="https://github.com/clash-lang/ghc-typelits-extra">ghc-typelits-extra</a>, is distributed on <a href="https://hackage.haskell.org/package/ghc-typelits-extra">Hackage</a> and <a href="https://www.stackage.org/lts-18.0/package/ghc-typelits-extra-0.4.2">Stackage</a>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb35-1" title="1"><span class="ot">{-# OPTIONS_GHC -fplugin GHC.TypeLits.Extra.Solver #-}</span></a>
<a class="sourceLine" id="cb35-2" title="2"></a>
<a class="sourceLine" id="cb35-3" title="3"><span class="ot">{-# LANGUAGE KindSignatures #-}</span></a>
<a class="sourceLine" id="cb35-4" title="4"><span class="ot">{-# LANGUAGE DataKinds #-}</span></a>
<a class="sourceLine" id="cb35-5" title="5"><span class="ot">{-# LANGUAGE GADTs #-}</span></a>
<a class="sourceLine" id="cb35-6" title="6"><span class="ot">{-# LANGUAGE TypeOperators #-}</span></a>
<a class="sourceLine" id="cb35-7" title="7"><span class="ot">{-# LANGUAGE TypeApplications #-}</span></a>
<a class="sourceLine" id="cb35-8" title="8"><span class="ot">{-# LANGUAGE ScopedTypeVariables #-}</span></a>
<a class="sourceLine" id="cb35-9" title="9"></a>
<a class="sourceLine" id="cb35-10" title="10"><span class="kw">module</span> <span class="dt">VolpanoSmith</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb35-11" title="11"></a>
<a class="sourceLine" id="cb35-12" title="12"><span class="kw">import</span> <span class="dt">GHC.TypeLits</span> (<span class="dt">Nat</span>, type (&lt;=))</a>
<a class="sourceLine" id="cb35-13" title="13"><span class="kw">import</span> <span class="dt">GHC.TypeLits.Extra</span> (<span class="dt">Max</span>, <span class="dt">Min</span>)</a>
<a class="sourceLine" id="cb35-14" title="14"><span class="kw">import</span> <span class="dt">Data.Kind</span> (<span class="dt">Type</span>)</a>
<a class="sourceLine" id="cb35-15" title="15"><span class="kw">import</span> <span class="dt">Data.Data</span> (type (:~:)(<span class="dt">Refl</span>))</a>
<a class="sourceLine" id="cb35-16" title="16"></a>
<a class="sourceLine" id="cb35-17" title="17"><span class="co">--------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb35-18" title="18"><span class="co">-- Basic language without Information-Flow Security enforcement</span></a>
<a class="sourceLine" id="cb35-19" title="19"><span class="co">--------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb35-20" title="20"></a>
<a class="sourceLine" id="cb35-21" title="21"><span class="kw">newtype</span> <span class="dt">Variable0</span> <span class="fu">=</span> <span class="dt">Variable0</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb35-22" title="22"></a>
<a class="sourceLine" id="cb35-23" title="23"><span class="kw">infixr</span> <span class="dv">6</span> <span class="fu">:+.</span></a>
<a class="sourceLine" id="cb35-24" title="24"><span class="kw">data</span> <span class="dt">Exp0</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb35-25" title="25">  <span class="dt">EInt0</span><span class="ot"> ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Exp0</span></a>
<a class="sourceLine" id="cb35-26" title="26">  <span class="dt">EVar0</span><span class="ot"> ::</span> <span class="dt">Variable0</span> <span class="ot">-&gt;</span> <span class="dt">Exp0</span></a>
<a class="sourceLine" id="cb35-27" title="27"><span class="ot">  (:+.) ::</span> <span class="dt">Exp0</span> <span class="ot">-&gt;</span> <span class="dt">Exp0</span> <span class="ot">-&gt;</span> <span class="dt">Exp0</span></a>
<a class="sourceLine" id="cb35-28" title="28"></a>
<a class="sourceLine" id="cb35-29" title="29"><span class="kw">infixl</span> <span class="dv">5</span> <span class="fu">:=.</span></a>
<a class="sourceLine" id="cb35-30" title="30"><span class="kw">infixl</span> <span class="dv">4</span> <span class="fu">:&gt;&gt;.</span></a>
<a class="sourceLine" id="cb35-31" title="31"><span class="kw">data</span> <span class="dt">Cmd0</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb35-32" title="32"><span class="ot">  (:=.)  ::</span> <span class="dt">Variable0</span> <span class="ot">-&gt;</span> <span class="dt">Exp0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd0</span></a>
<a class="sourceLine" id="cb35-33" title="33"><span class="ot">  (:&gt;&gt;.) ::</span> <span class="dt">Cmd0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd0</span></a>
<a class="sourceLine" id="cb35-34" title="34">  <span class="dt">ITE0</span><span class="ot">   ::</span> <span class="dt">Exp0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd0</span></a>
<a class="sourceLine" id="cb35-35" title="35">  <span class="dt">While0</span><span class="ot"> ::</span> <span class="dt">Exp0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd0</span></a>
<a class="sourceLine" id="cb35-36" title="36"></a>
<a class="sourceLine" id="cb35-37" title="37"><span class="kw">type</span> <span class="dt">Program0</span> <span class="fu">=</span> <span class="dt">Cmd0</span></a>
<a class="sourceLine" id="cb35-38" title="38"></a>
<a class="sourceLine" id="cb35-39" title="39"><span class="ot">simpleProgram ::</span> <span class="dt">Program0</span></a>
<a class="sourceLine" id="cb35-40" title="40">simpleProgram <span class="fu">=</span></a>
<a class="sourceLine" id="cb35-41" title="41">  x <span class="fu">:=.</span> <span class="dt">EInt0</span> <span class="dv">42</span> <span class="fu">:&gt;&gt;.</span></a>
<a class="sourceLine" id="cb35-42" title="42">  <span class="dt">ITE0</span> (<span class="dt">EVar0</span> x)</a>
<a class="sourceLine" id="cb35-43" title="43">    (<span class="dt">While0</span> (<span class="dt">EVar0</span> y) <span class="fu">$</span></a>
<a class="sourceLine" id="cb35-44" title="44">      y <span class="fu">:=.</span> <span class="dt">EVar0</span> y <span class="fu">:+.</span> <span class="dt">EInt0</span> (<span class="fu">-</span><span class="dv">1</span>) <span class="fu">:&gt;&gt;.</span></a>
<a class="sourceLine" id="cb35-45" title="45">      x <span class="fu">:=.</span> <span class="dt">EVar0</span> x <span class="fu">:+.</span> <span class="dt">EInt0</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb35-46" title="46">    (y <span class="fu">:=.</span> <span class="dt">EInt0</span> <span class="dv">24</span>)</a>
<a class="sourceLine" id="cb35-47" title="47">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb35-48" title="48">  x <span class="fu">=</span> <span class="dt">Variable0</span> <span class="st">&quot;x&quot;</span></a>
<a class="sourceLine" id="cb35-49" title="49">  y <span class="fu">=</span> <span class="dt">Variable0</span> <span class="st">&quot;y&quot;</span></a>
<a class="sourceLine" id="cb35-50" title="50"></a>
<a class="sourceLine" id="cb35-51" title="51"><span class="co">--------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb35-52" title="52"><span class="co">-- Privacy enforcing programs</span></a>
<a class="sourceLine" id="cb35-53" title="53"><span class="co">--------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb35-54" title="54"></a>
<a class="sourceLine" id="cb35-55" title="55"><span class="kw">type</span> <span class="dt">Level</span> <span class="fu">=</span> <span class="dt">Nat</span></a>
<a class="sourceLine" id="cb35-56" title="56"></a>
<a class="sourceLine" id="cb35-57" title="57"><span class="kw">newtype</span> <span class="dt">Variable</span> (<span class="ot">l ::</span> <span class="dt">Level</span>) <span class="fu">=</span> <span class="dt">Variable</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb35-58" title="58"></a>
<a class="sourceLine" id="cb35-59" title="59"><span class="kw">infixr</span> <span class="dv">6</span> <span class="fu">:+</span></a>
<a class="sourceLine" id="cb35-60" title="60"><span class="kw">data</span> <span class="dt">Exp</span> (<span class="ot">level ::</span> <span class="dt">Level</span>) <span class="kw">where</span></a>
<a class="sourceLine" id="cb35-61" title="61">  <span class="dt">EInt</span><span class="ot">  ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Exp</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb35-62" title="62">  <span class="dt">EVar</span><span class="ot">  ::</span> <span class="dt">Variable</span> level <span class="ot">-&gt;</span> <span class="dt">Exp</span> level</a>
<a class="sourceLine" id="cb35-63" title="63"><span class="ot">  (:+) ::</span> <span class="dt">Exp</span> level1 <span class="ot">-&gt;</span> <span class="dt">Exp</span> level2 <span class="ot">-&gt;</span> <span class="dt">Exp</span> (<span class="dt">Max</span> level1 level2)</a>
<a class="sourceLine" id="cb35-64" title="64"></a>
<a class="sourceLine" id="cb35-65" title="65"><span class="kw">infixl</span> <span class="dv">5</span> <span class="fu">:=</span></a>
<a class="sourceLine" id="cb35-66" title="66"><span class="kw">infixl</span> <span class="dv">4</span> <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-67" title="67"><span class="kw">data</span> <span class="dt">Cmd</span> (<span class="ot">level ::</span> <span class="dt">Level</span>) <span class="kw">where</span></a>
<a class="sourceLine" id="cb35-68" title="68"><span class="ot">  (:=)  ::</span> (le <span class="fu">&lt;=</span> lx) <span class="ot">=&gt;</span> <span class="dt">Variable</span> lx <span class="ot">-&gt;</span> <span class="dt">Exp</span> le <span class="ot">-&gt;</span> <span class="dt">Cmd</span> lx</a>
<a class="sourceLine" id="cb35-69" title="69"><span class="ot">  (:&gt;&gt;) ::</span> <span class="dt">Cmd</span> l1 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l2 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> (<span class="dt">Min</span> l1 l2)</a>
<a class="sourceLine" id="cb35-70" title="70">  <span class="dt">ITE</span><span class="ot">   ::</span> (lb <span class="fu">&lt;=</span> <span class="dt">Min</span> l1 l2) <span class="ot">=&gt;</span> <span class="dt">Exp</span> lb <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l1 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l2 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> (<span class="dt">Min</span> l1 l2)</a>
<a class="sourceLine" id="cb35-71" title="71">  <span class="dt">While</span><span class="ot"> ::</span> (lb <span class="fu">&lt;=</span> l) <span class="ot">=&gt;</span> <span class="dt">Exp</span> lb <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l</a>
<a class="sourceLine" id="cb35-72" title="72"></a>
<a class="sourceLine" id="cb35-73" title="73"><span class="kw">data</span> <span class="dt">Program</span> (<span class="ot">cmd ::</span> <span class="dt">Level</span> <span class="ot">-&gt;</span> <span class="dt">Type</span>) <span class="fu">=</span> <span class="kw">forall</span> l<span class="fu">.</span> <span class="dt">Program</span> (cmd l)</a>
<a class="sourceLine" id="cb35-74" title="74"></a>
<a class="sourceLine" id="cb35-75" title="75"><span class="co">--------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb35-76" title="76"><span class="co">-- Example programs</span></a>
<a class="sourceLine" id="cb35-77" title="77"><span class="co">--------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb35-78" title="78"></a>
<a class="sourceLine" id="cb35-79" title="79"><span class="ot">public ::</span> <span class="dt">Variable</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb35-80" title="80">public <span class="fu">=</span> <span class="dt">Variable</span> <span class="st">&quot;public&quot;</span></a>
<a class="sourceLine" id="cb35-81" title="81"></a>
<a class="sourceLine" id="cb35-82" title="82"><span class="ot">private ::</span> <span class="dt">Variable</span> <span class="dv">999</span></a>
<a class="sourceLine" id="cb35-83" title="83">private <span class="fu">=</span> <span class="dt">Variable</span> <span class="st">&quot;private&quot;</span></a>
<a class="sourceLine" id="cb35-84" title="84"></a>
<a class="sourceLine" id="cb35-85" title="85"><span class="ot">compoundPrivateExp ::</span> <span class="dt">Exp</span> <span class="dv">999</span></a>
<a class="sourceLine" id="cb35-86" title="86">compoundPrivateExp <span class="fu">=</span> <span class="dt">EVar</span> public <span class="fu">:+</span> <span class="dt">EVar</span> private</a>
<a class="sourceLine" id="cb35-87" title="87"></a>
<a class="sourceLine" id="cb35-88" title="88"><span class="ot">simpleAssignmentOK ::</span> <span class="dt">Program</span> <span class="dt">Cmd</span></a>
<a class="sourceLine" id="cb35-89" title="89">simpleAssignmentOK <span class="fu">=</span> <span class="dt">Program</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb35-90" title="90">  private <span class="fu">:=</span> <span class="dt">EVar</span> public</a>
<a class="sourceLine" id="cb35-91" title="91"></a>
<a class="sourceLine" id="cb35-92" title="92">  <span class="co">{-</span></a>
<a class="sourceLine" id="cb35-93" title="93"><span class="co">simpleAssignmentKO :: Program Cmd</span></a>
<a class="sourceLine" id="cb35-94" title="94"><span class="co">simpleAssignmentKO = Program $</span></a>
<a class="sourceLine" id="cb35-95" title="95"><span class="co">  public := EVar private</span></a>
<a class="sourceLine" id="cb35-96" title="96"><span class="co">  -}</span></a>
<a class="sourceLine" id="cb35-97" title="97"></a>
<a class="sourceLine" id="cb35-98" title="98"><span class="ot">tempAssignmentOK ::</span> <span class="dt">Program</span> <span class="dt">Cmd</span></a>
<a class="sourceLine" id="cb35-99" title="99">tempAssignmentOK <span class="fu">=</span> <span class="dt">Program</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb35-100" title="100">  temp <span class="fu">:=</span> <span class="dt">EVar</span> public <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-101" title="101">  private <span class="fu">:=</span> <span class="dt">EVar</span> temp</a>
<a class="sourceLine" id="cb35-102" title="102">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb35-103" title="103">  temp <span class="fu">=</span> <span class="dt">Variable</span> <span class="fu">@</span><span class="dv">5</span> <span class="st">&quot;temp&quot;</span></a>
<a class="sourceLine" id="cb35-104" title="104"></a>
<a class="sourceLine" id="cb35-105" title="105"><span class="ot">implicitPublicFlowOK ::</span> <span class="dt">Program</span> <span class="dt">Cmd</span></a>
<a class="sourceLine" id="cb35-106" title="106">implicitPublicFlowOK <span class="fu">=</span> <span class="dt">Program</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb35-107" title="107">  <span class="dt">ITE</span> (<span class="dt">EVar</span> public)</a>
<a class="sourceLine" id="cb35-108" title="108">    (public <span class="fu">:=</span> <span class="dt">EInt</span> <span class="dv">42</span>)</a>
<a class="sourceLine" id="cb35-109" title="109">    (private <span class="fu">:=</span> <span class="dt">EVar</span> public)</a>
<a class="sourceLine" id="cb35-110" title="110"></a>
<a class="sourceLine" id="cb35-111" title="111">  <span class="co">{-</span></a>
<a class="sourceLine" id="cb35-112" title="112"><span class="co">implicitPrivateFlowKO :: Program Cmd</span></a>
<a class="sourceLine" id="cb35-113" title="113"><span class="co">implicitPrivateFlowKO = Program $</span></a>
<a class="sourceLine" id="cb35-114" title="114"><span class="co">  ITE (EVar private)</span></a>
<a class="sourceLine" id="cb35-115" title="115"><span class="co">    (public := EInt 42)</span></a>
<a class="sourceLine" id="cb35-116" title="116"><span class="co">    (private := EVar public)</span></a>
<a class="sourceLine" id="cb35-117" title="117"><span class="co">  -}</span></a>
<a class="sourceLine" id="cb35-118" title="118"></a>
<a class="sourceLine" id="cb35-119" title="119">  <span class="co">{-</span></a>
<a class="sourceLine" id="cb35-120" title="120"><span class="co">implicitPrivateFlowOKKO :: Program Cmd</span></a>
<a class="sourceLine" id="cb35-121" title="121"><span class="co">implicitPrivateFlowOKKO = Program $</span></a>
<a class="sourceLine" id="cb35-122" title="122"><span class="co">  ITE (EVar private)</span></a>
<a class="sourceLine" id="cb35-123" title="123"><span class="co">    (public := EInt 42)</span></a>
<a class="sourceLine" id="cb35-124" title="124"><span class="co">    (public := EInt 42)</span></a>
<a class="sourceLine" id="cb35-125" title="125"><span class="co">  -}</span></a>
<a class="sourceLine" id="cb35-126" title="126"></a>
<a class="sourceLine" id="cb35-127" title="127"><span class="ot">implicitPrivateFlowOK ::</span> <span class="dt">Program</span> <span class="dt">Cmd</span></a>
<a class="sourceLine" id="cb35-128" title="128">implicitPrivateFlowOK <span class="fu">=</span> <span class="dt">Program</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb35-129" title="129">  <span class="dt">ITE</span> (<span class="dt">EVar</span> private)</a>
<a class="sourceLine" id="cb35-130" title="130">    (private <span class="fu">:=</span> <span class="dt">EInt</span> <span class="dv">42</span>)</a>
<a class="sourceLine" id="cb35-131" title="131">    (private <span class="fu">:=</span> <span class="dt">EVar</span> public)</a>
<a class="sourceLine" id="cb35-132" title="132"></a>
<a class="sourceLine" id="cb35-133" title="133"><span class="ot">lemmaMax0 ::</span> <span class="dt">Max</span> level <span class="dv">0</span> <span class="fu">:~:</span> level</a>
<a class="sourceLine" id="cb35-134" title="134">lemmaMax0 <span class="fu">=</span> <span class="dt">Refl</span></a>
<a class="sourceLine" id="cb35-135" title="135"></a>
<a class="sourceLine" id="cb35-136" title="136"><span class="ot">adder ::</span> <span class="kw">forall</span> level<span class="fu">.</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Variable</span> level <span class="ot">-&gt;</span> <span class="dt">Cmd</span> level</a>
<a class="sourceLine" id="cb35-137" title="137">adder i var <span class="fu">|</span> <span class="dt">Refl</span> <span class="ot">&lt;-</span> lemmaMax0 <span class="fu">@</span>level <span class="fu">=</span> var <span class="fu">:=</span> <span class="dt">EVar</span> var <span class="fu">:+</span> <span class="dt">EInt</span> i</a>
<a class="sourceLine" id="cb35-138" title="138"></a>
<a class="sourceLine" id="cb35-139" title="139">inc,<span class="ot"> dec ::</span> <span class="dt">Variable</span> level <span class="ot">-&gt;</span> <span class="dt">Cmd</span> level</a>
<a class="sourceLine" id="cb35-140" title="140">inc <span class="fu">=</span> adder <span class="dv">1</span></a>
<a class="sourceLine" id="cb35-141" title="141">dec <span class="fu">=</span> adder (<span class="fu">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb35-142" title="142"></a>
<a class="sourceLine" id="cb35-143" title="143"><span class="ot">halveOK ::</span> <span class="dt">Program</span> <span class="dt">Cmd</span></a>
<a class="sourceLine" id="cb35-144" title="144">halveOK <span class="fu">=</span> <span class="dt">Program</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb35-145" title="145">  finished <span class="fu">:=</span> <span class="dt">EInt</span> <span class="dv">0</span> <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-146" title="146">  public <span class="fu">:=</span> <span class="dt">EInt</span> <span class="dv">42</span> <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-147" title="147">  <span class="dt">While</span> (<span class="dt">EVar</span> pubCounter)</a>
<a class="sourceLine" id="cb35-148" title="148">    (dec pubCounter <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-149" title="149">     dec pubCounter <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-150" title="150">     inc public) <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-151" title="151">  inc finished</a>
<a class="sourceLine" id="cb35-152" title="152">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb35-153" title="153">  finished <span class="fu">=</span> <span class="dt">Variable</span> <span class="fu">@</span><span class="dv">0</span> <span class="st">&quot;finished&quot;</span></a>
<a class="sourceLine" id="cb35-154" title="154">  pubCounter <span class="fu">=</span> <span class="dt">Variable</span> <span class="fu">@</span><span class="dv">0</span> <span class="st">&quot;pubCounter&quot;</span></a>
<a class="sourceLine" id="cb35-155" title="155"></a>
<a class="sourceLine" id="cb35-156" title="156"><span class="ot">halveCovertKO ::</span> <span class="dt">Program</span> <span class="dt">Cmd</span></a>
<a class="sourceLine" id="cb35-157" title="157">halveCovertKO <span class="fu">=</span> <span class="dt">Program</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb35-158" title="158">  finished <span class="fu">:=</span> <span class="dt">EInt</span> <span class="dv">0</span> <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-159" title="159">  private <span class="fu">:=</span> <span class="dt">EInt</span> <span class="dv">42</span> <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-160" title="160">  <span class="dt">While</span> (<span class="dt">EVar</span> privCounter)</a>
<a class="sourceLine" id="cb35-161" title="161">    (dec privCounter <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-162" title="162">     dec privCounter <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-163" title="163">     inc private) <span class="fu">:&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-164" title="164">  inc finished</a>
<a class="sourceLine" id="cb35-165" title="165">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb35-166" title="166">  finished <span class="fu">=</span> <span class="dt">Variable</span> <span class="fu">@</span><span class="dv">0</span> <span class="st">&quot;finished&quot;</span></a>
<a class="sourceLine" id="cb35-167" title="167">  privCounter <span class="fu">=</span> <span class="dt">Variable</span> <span class="fu">@</span><span class="dv">42</span> <span class="st">&quot;privCounter&quot;</span></a>
<a class="sourceLine" id="cb35-168" title="168"></a>
<a class="sourceLine" id="cb35-169" title="169"><span class="co">--------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb35-170" title="170"><span class="co">-- Termination-sensitive privacy enforcing programs</span></a>
<a class="sourceLine" id="cb35-171" title="171"><span class="co">--------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb35-172" title="172"></a>
<a class="sourceLine" id="cb35-173" title="173"><span class="kw">infixl</span> <span class="dv">5</span> <span class="fu">:==</span></a>
<a class="sourceLine" id="cb35-174" title="174"><span class="kw">infixl</span> <span class="dv">4</span> <span class="fu">:&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-175" title="175"><span class="kw">data</span> <span class="dt">Cmd'</span> (<span class="ot">level ::</span> <span class="dt">Level</span>) <span class="kw">where</span></a>
<a class="sourceLine" id="cb35-176" title="176">  <span class="dt">Skip'</span><span class="ot">  ::</span> <span class="dt">Cmd'</span> level</a>
<a class="sourceLine" id="cb35-177" title="177"><span class="ot">  (:==)  ::</span> (le <span class="fu">&lt;=</span> lx) <span class="ot">=&gt;</span> <span class="dt">Variable</span> lx <span class="ot">-&gt;</span> <span class="dt">Exp</span> le <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> lx</a>
<a class="sourceLine" id="cb35-178" title="178"><span class="ot">  (:&gt;&gt;&gt;) ::</span> <span class="dt">Cmd'</span> l1 <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> l2 <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> (<span class="dt">Min</span> l1 l2)</a>
<a class="sourceLine" id="cb35-179" title="179">  <span class="dt">ITE'</span><span class="ot">   ::</span> (lb <span class="fu">&lt;=</span> <span class="dt">Min</span> l1 l2) <span class="ot">=&gt;</span> <span class="dt">Exp</span> lb <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> l1 <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> l2 <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> (<span class="dt">Min</span> l1 l2)</a>
<a class="sourceLine" id="cb35-180" title="180">  <span class="dt">While'</span><span class="ot"> ::</span> <span class="dt">Exp</span> <span class="dv">0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> l <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> l</a>
<a class="sourceLine" id="cb35-181" title="181"></a>
<a class="sourceLine" id="cb35-182" title="182"><span class="ot">adder' ::</span> <span class="kw">forall</span> level<span class="fu">.</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Variable</span> level <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> level</a>
<a class="sourceLine" id="cb35-183" title="183">adder' i var <span class="fu">|</span> <span class="dt">Refl</span> <span class="ot">&lt;-</span> lemmaMax0 <span class="fu">@</span>level <span class="fu">=</span> var <span class="fu">:==</span> <span class="dt">EVar</span> var <span class="fu">:+</span> <span class="dt">EInt</span> i</a>
<a class="sourceLine" id="cb35-184" title="184"></a>
<a class="sourceLine" id="cb35-185" title="185">inc',<span class="ot"> dec' ::</span> <span class="dt">Variable</span> level <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> level</a>
<a class="sourceLine" id="cb35-186" title="186">inc' <span class="fu">=</span> adder' <span class="dv">1</span></a>
<a class="sourceLine" id="cb35-187" title="187">dec' <span class="fu">=</span> adder' (<span class="fu">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb35-188" title="188"></a>
<a class="sourceLine" id="cb35-189" title="189"><span class="ot">halveOK' ::</span> <span class="dt">Program</span> <span class="dt">Cmd'</span></a>
<a class="sourceLine" id="cb35-190" title="190">halveOK' <span class="fu">=</span> <span class="dt">Program</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb35-191" title="191">  finished <span class="fu">:==</span> <span class="dt">EInt</span> <span class="dv">0</span> <span class="fu">:&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-192" title="192">  private <span class="fu">:==</span> <span class="dt">EInt</span> <span class="dv">0</span> <span class="fu">:&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-193" title="193">  <span class="dt">While'</span> (<span class="dt">EVar</span> pubCounter)</a>
<a class="sourceLine" id="cb35-194" title="194">    (dec' pubCounter <span class="fu">:&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-195" title="195">     dec' pubCounter <span class="fu">:&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-196" title="196">     inc' private) <span class="fu">:&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-197" title="197">  inc' finished</a>
<a class="sourceLine" id="cb35-198" title="198">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb35-199" title="199">  finished <span class="fu">=</span> <span class="dt">Variable</span> <span class="fu">@</span><span class="dv">0</span> <span class="st">&quot;finished&quot;</span></a>
<a class="sourceLine" id="cb35-200" title="200">  pubCounter <span class="fu">=</span> <span class="dt">Variable</span> <span class="fu">@</span><span class="dv">0</span> <span class="st">&quot;pubCounter&quot;</span></a>
<a class="sourceLine" id="cb35-201" title="201"></a>
<a class="sourceLine" id="cb35-202" title="202">  <span class="co">{-</span></a>
<a class="sourceLine" id="cb35-203" title="203"><span class="co">halveCovertKO' :: Program Cmd'</span></a>
<a class="sourceLine" id="cb35-204" title="204"><span class="co">halveCovertKO' = Program $</span></a>
<a class="sourceLine" id="cb35-205" title="205"><span class="co">  finished :== EInt 0 :&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-206" title="206"><span class="co">  private :== EInt 0 :&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-207" title="207"><span class="co">  While' (EVar privCounter)</span></a>
<a class="sourceLine" id="cb35-208" title="208"><span class="co">    (dec' privCounter :&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-209" title="209"><span class="co">     dec' privCounter :&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-210" title="210"><span class="co">     inc' private) :&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-211" title="211"><span class="co">  inc' finished</span></a>
<a class="sourceLine" id="cb35-212" title="212"><span class="co">  where</span></a>
<a class="sourceLine" id="cb35-213" title="213"><span class="co">  finished = Variable @0 &quot;finished&quot;</span></a>
<a class="sourceLine" id="cb35-214" title="214"><span class="co">  privCounter = Variable @42 &quot;privCounter&quot;</span></a>
<a class="sourceLine" id="cb35-215" title="215"><span class="co">  -}</span></a>
<a class="sourceLine" id="cb35-216" title="216"></a>
<a class="sourceLine" id="cb35-217" title="217">  <span class="co">{-</span></a>
<a class="sourceLine" id="cb35-218" title="218"><span class="co">halveCovertOKKO :: Program Cmd'</span></a>
<a class="sourceLine" id="cb35-219" title="219"><span class="co">halveCovertOKKO = Program $</span></a>
<a class="sourceLine" id="cb35-220" title="220"><span class="co">  privCounter :== EInt 42 :&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-221" title="221"><span class="co">  finished :== EInt 0 :&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-222" title="222"><span class="co">  private :== EInt 0 :&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-223" title="223"><span class="co">  While' (EVar privCounter)</span></a>
<a class="sourceLine" id="cb35-224" title="224"><span class="co">    (dec' privCounter :&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-225" title="225"><span class="co">     dec' privCounter :&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-226" title="226"><span class="co">     inc' private) :&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb35-227" title="227"><span class="co">  inc' finished</span></a>
<a class="sourceLine" id="cb35-228" title="228"><span class="co">  where</span></a>
<a class="sourceLine" id="cb35-229" title="229"><span class="co">  finished = Variable @0 &quot;finished&quot;</span></a>
<a class="sourceLine" id="cb35-230" title="230"><span class="co">  privCounter = Variable @42 &quot;privCounter&quot;</span></a>
<a class="sourceLine" id="cb35-231" title="231"><span class="co">  -}</span></a></code></pre></div></div>

<script>
var figures =
  Array.prototype.slice.call(document.getElementsByClassName("figure"),0)
  .concat(
    Array.prototype.slice.call(document.getElementsByTagName("figure"),0));

for (var i = 0; i < figures.length; i++) {
  var figure = figures[i];
  var imgs = figure.getElementsByTagName("img");
  if (imgs.length > 0) {
    classes = imgs[0].classList;
    for (var j = 0; j < classes.length; j++) {
      figure.classList.add(classes[j] + "-figure");
    }
  }
}
</script>

        </div>
        <div id="footer">
          <div class="top-container">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
          </div>
        </div>
    </body>
</html>
