<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
         <!-- Google tag (gtag.js) -->
         <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z5H0ZJ67R9"></script>
         <script>
           window.dataLayer = window.dataLayer || [];
           function gtag(){dataLayer.push(arguments);}
           gtag('js', new Date());

           gtag('config', 'G-Z5H0ZJ67R9');
         </script>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="description" content="Mistral Contrastin's thought bubble,
          blog, and personal revelations." />
        <meta name="author" content="Mistral Contrastin" />
        <title>Do disturb me | Typed Programs Don't Leak Data</title>
        <link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet" />
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
        <link rel="alternate" type="application/atom+xml" href="../atom.xml" />

        <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png" />
        <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png" />
    </head>
    <body>
        <div id="header">
            <div class="top-container">
              <div id="logo">
                  <a href="../">Do Disturb Me</a>
              </div>
              <div id="navigation">
                  <a href="../archive.html">Blog</a>
                  <a href="../teaching.html">Teaching</a>
              </div>
            </div>
            <div id="mandelbrot"></div>
        </div>

        <div id="content">
            <div class="info">
  Posted on June 27, 2021
  
  
    and last updated on June 30, 2021
  
  by Mistral Contrastin
</div>

<h1>Typed Programs Don't Leak Data</h1>


<p class="in-which">In which we turn privacy violations into compile-time errors in a simple imperative language embedded in Haskell and enforce it using GADTs in style.</p>


<div class="post"><p>Private data should remain private. The goal is obvious, but how to achieve it
is less so.</p>
<p>For one thing, it is a fundamentally global problem. Private data can enter a
system through a fancy frontend, make its way deep through the maze of backend
services, only to be logged and read by someone who is not supposed to. It is
not practical for people to audit a large system end-to-end and even less
realistic to expect such an audit to hold up against software evolution. What we
need is an automated and <em>compositional</em> solution.</p>
<p>Further, privacy as a property is not always amenable to testing. The most
<em>explicit</em> cases of leakage such as</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>publicStatus <span class="op">=</span> privateMaritalStatus<span class="op">;</span></span></code></pre></div>
<p>can perhaps be tested, but how about the more <em>implicit</em> forms of
leakage. Consider</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>privateMaritalStatus <span class="op">==</span> <span class="st">&quot;single&quot;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  publicStatus <span class="op">=</span> <span class="st">&quot;available&quot;</span><span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  publicStatus <span class="op">=</span> <span class="st">&quot;complicated&quot;</span><span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>where private marital status doesn‚Äôt physically move to the public status, but
by observing the public status, we can figure something out about the private
data. Without reifying these implicit flows at runtime, it doesn‚Äôt look like we
can write tests.</p>
<p>The nightmare doesn‚Äôt end there. There are subtler ways of leaking data such as
non-termination, execution time, and exceptions. Perhaps the most famous example
is figuring out passwords by measuring the time it takes for a program to reject
candidate passwords. The longer rejection takes, the longer password prefix can
be deduced.</p>
<p>There are multitude of ways of mitigating these problems using both dynamic and
static methods. In this post, we focus on <strong>a type system that regulates
explicit and implicit dataflows as well as non-termination as a covert
channel</strong>. This approach has no runtime impact, covers all executions, and is
compositional, hence easy to scale. See <a href="#final-words">the end of this post</a>
for its foundations.</p>
<p>We won‚Äôt shy away from harnessing the full might of GHC. If you are comfortable
with Generalised Algebraic Datatypes (GADTs), it should be easy to follow along.
Otherwise, you can visit one of many GADT tutorials out there (including <a href="../posts/2019-10-03-Verifying-the-Titular-Properties-of-a-Leftist-Heap.html">my
exposition on type-level prgramming in
Haskell</a>
that includes GADTs and much more) and come back. Alternatively, the
privacy-related ideas should be accessible by following the prose and the
inference rules alone. If you want to follow along using Haskell, the necessary
imports, extensions, and typechecker plugin can be found at <a href="#full-program">the end of this
post</a> as well as <a href="https://github.com/madgen/volpano-smith">this
repository</a>.</p>
<p>If you find a mistake, some explanation to be unclear, or just want to say hi,
reach me on <a href="https://twitter.com/madgen_">Twitter</a> or by other ways listed on
my homepage.</p>
<p>Let‚Äôs get started.</p>
<h2 id="a-simple-imperative-language">A simple imperative language</h2>
<p>We‚Äôll use the most contrived language possible that demonstrates all the major
ideas. First, we define everything using simple types that does not make use of
any fancy type machinery.</p>
<p>The expression language has integer literals, variables, and addition.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Variable</span> <span class="ot">=</span> <span class="dt">Variable</span> <span class="dt">String</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">infixr</span> <span class="dv">6</span> <span class="op">:+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Exp</span> <span class="kw">where</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">EInt</span><span class="ot"> ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Exp</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">EVar</span><span class="ot"> ::</span> <span class="dt">Variable</span> <span class="ot">-&gt;</span> <span class="dt">Exp</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="ot">  (:+) ::</span> <span class="dt">Exp</span> <span class="ot">-&gt;</span> <span class="dt">Exp</span> <span class="ot">-&gt;</span> <span class="dt">Exp</span></span></code></pre></div>
<p>The tiny imperative language has assignments, sequencing, if-then-else
statements, and while loops.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">infixl</span> <span class="dv">5</span> <span class="op">:=</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">infixl</span> <span class="dv">4</span> <span class="op">:&gt;&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Cmd</span> <span class="kw">where</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="ot">  (:=)  ::</span> <span class="dt">Variable</span> <span class="ot">-&gt;</span> <span class="dt">Exp</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ot">  (:&gt;&gt;) ::</span> <span class="dt">Cmd</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ITE</span><span class="ot">   ::</span> <span class="dt">Exp</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">While</span><span class="ot"> ::</span> <span class="dt">Exp</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="kw">newtype</span> <span class="dt">Program</span> <span class="ot">=</span> <span class="dt">Program</span> <span class="dt">Cmd</span></span></code></pre></div>
<p>Here‚Äôs a simple program in this language</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ot">simpleProgram ::</span> <span class="dt">Program</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>simpleProgram <span class="ot">=</span> <span class="dt">Program</span> <span class="op">$</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  x <span class="op">:=</span> <span class="dt">EInt</span> <span class="dv">42</span> <span class="op">:&gt;&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ITE</span> (<span class="dt">EVar</span> x)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    (<span class="dt">While</span> (<span class="dt">EVar</span> y) <span class="op">$</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>      y <span class="op">:=</span> <span class="dt">EVar</span> y <span class="op">:+</span> <span class="dt">EInt</span> (<span class="op">-</span><span class="dv">1</span>) <span class="op">:&gt;&gt;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>      x <span class="op">:=</span> <span class="dt">EVar</span> x <span class="op">:+</span> <span class="dt">EInt</span> <span class="dv">1</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    (y <span class="op">:=</span> <span class="dt">EInt</span> <span class="dv">24</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="dt">Variable</span> <span class="st">&quot;x&quot;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">=</span> <span class="dt">Variable</span> <span class="st">&quot;y&quot;</span></span></code></pre></div>
<p>In more traditional syntax, this program corresponds to the following:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">42</span><span class="op">;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> <span class="op">(</span>y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> y <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> x <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  y <span class="op">=</span> <span class="dv">24</span><span class="op">;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>At this point, we should write an evaluator function to give dynamic semantics
to this language, but there is nothing interesting about it. So, we‚Äôll skip it.
The intuitive evaluation of the language is the right one. The only oddity is
that we treat <code>0</code> as false and any other number as true when an expression is
used as a condition.</p>
<h2 id="typing-our-language">Typing our language</h2>
<p>Now that we are acquainted with the language, let‚Äôs prevent private data from
leaking.</p>
<h3 id="security-levels">Security levels</h3>
<p>We need to distinguish private from public. We‚Äôll use natural numbers to do
that. The higher the value, the more private it is. All variables in our
language have intrinsic security levels reflected in their types.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">Level</span> <span class="ot">=</span> <span class="dt">Nat</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">newtype</span> <span class="dt">Variable</span> (<span class="ot">l ::</span> <span class="dt">Level</span>) <span class="ot">=</span> <span class="dt">Variable</span> <span class="dt">String</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="ot">public ::</span> <span class="dt">Variable</span> <span class="dv">0</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>public <span class="ot">=</span> <span class="dt">Variable</span> <span class="st">&quot;public&quot;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="ot">private ::</span> <span class="dt">Variable</span> <span class="dv">999</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>private <span class="ot">=</span> <span class="dt">Variable</span> <span class="st">&quot;private&quot;</span></span></code></pre></div>
<h3 id="expressions">Expressions</h3>
<p>The expression language is structurally the same as the simply typed version,
but expression types now reflect how private expressions are.</p>
<p>For variable expressions, the obvious choice is to use the security level of the
underlying variable. The literals are all be public, i.e., they all have the
security level 0. Finally, for plus, we‚Äôll be conservative and pick the more
private security level. A folder that contains some top secret intelligence and
a pizzaria flyer cannot be handed to a pizza lover without security clearance.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">infixr</span> <span class="dv">6</span> <span class="op">:+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Exp</span> (<span class="ot">level ::</span> <span class="dt">Level</span>) <span class="kw">where</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">EInt</span><span class="ot"> ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Exp</span> <span class="dv">0</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">EVar</span><span class="ot"> ::</span> <span class="dt">Variable</span> level <span class="ot">-&gt;</span> <span class="dt">Exp</span> level</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="ot">  (:+) ::</span> <span class="dt">Exp</span> level1 <span class="ot">-&gt;</span> <span class="dt">Exp</span> level2 <span class="ot">-&gt;</span> <span class="dt">Exp</span> (<span class="dt">Max</span> level1 level2)</span></code></pre></div>
<p>Another way of writing these constructors would be using inference rules. <code>e : l</code> means <code>e</code> has a security level <code>l</code> and <code>v : l</code> means the intrinsic security
level of the variable <code>v</code> is <code>l</code>.</p>
<pre><code>  ----------
  EInt n : 0

    v : l
  ----------
  EVar v : l

  e1 : l1      e2 : l2
  --------------------
  e1 :+ e2 : max l1 l2</code></pre>
<p>Here‚Äôs a simple expression where GHC does the maximum computation for us behind
the scenes.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ot">compoundPrivateExp ::</span> <span class="dt">Exp</span> <span class="dv">999</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>compoundPrivateExp <span class="ot">=</span> <span class="dt">EVar</span> public <span class="op">:+</span> <span class="dt">EVar</span> private</span></code></pre></div>
<h3 id="commands">Commands</h3>
<p>Commands are where information flow happens and where our type system gets
interesting. Before we go over each constructor, here‚Äôs the definition in all of
its glory.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">infixl</span> <span class="dv">5</span> <span class="op">:=</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">infixl</span> <span class="dv">4</span> <span class="op">:&gt;&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Cmd</span> (<span class="ot">level ::</span> <span class="dt">Level</span>) <span class="kw">where</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ot">  (:=)  ::</span> (le <span class="op">&lt;=</span> lv) <span class="ot">=&gt;</span> <span class="dt">Variable</span> lv <span class="ot">-&gt;</span> <span class="dt">Exp</span> le <span class="ot">-&gt;</span> <span class="dt">Cmd</span> lv</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ot">  (:&gt;&gt;) ::</span> <span class="dt">Cmd</span> l1 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l2 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> (<span class="dt">Min</span> l1 l2)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ITE</span><span class="ot">   ::</span> (lb <span class="op">&lt;=</span> <span class="dt">Min</span> l1 l2) <span class="ot">=&gt;</span> <span class="dt">Exp</span> lb <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l1 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l2 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> (<span class="dt">Min</span> l1 l2)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">While</span><span class="ot"> ::</span> (lb <span class="op">&lt;=</span> l) <span class="ot">=&gt;</span> <span class="dt">Exp</span> lb <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l</span></code></pre></div>
<p>Structurally, this is identical to the simply typed commands. We have the same
constructors with the same number of arguments. However, it is different in two
major ways:</p>
<ol type="1">
<li>Each command now carries a security level. More precisely, they carry <strong>the
security level of the most public variable that was assigned in the
command</strong>. This will help us control implicit flows and covert channels, but
exactly how will only become clear when we look at if-then-else statements.</li>
<li>Constructors for assignment, conditional, and while statements now require
conditions on the security levels of their parameters.</li>
</ol>
<p>In the end, we don‚Äôt care about the security level of a command, it is only
necessary to bar bad data flows. So it can be hidden away once we construct the
program with the help of an existential type.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Program</span> <span class="ot">=</span> <span class="kw">forall</span> level<span class="op">.</span> <span class="dt">Program</span> (<span class="dt">Cmd</span> level)</span></code></pre></div>
<p>We now go over each of these constructors one by one. Just as we did for
expressions, we present the inference rule corresponding to each constructor.
The judgement <code>c : l</code> means that the lowest security level that the command <code>c</code>
assigns to is <code>l</code>.</p>
<h4 id="assignment">Assignment</h4>
<p>The assignment rule is fundamental because it is the only way in the language
to leak data.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ot">(:=) ::</span> (le <span class="op">&lt;=</span> lv) <span class="ot">=&gt;</span> <span class="dt">Variable</span> lv <span class="ot">-&gt;</span> <span class="dt">Exp</span> le <span class="ot">-&gt;</span> <span class="dt">Cmd</span> lv</span></code></pre></div>
<p>The equivalent inference rule:</p>
<pre><code>  v : lv    e : le    le &lt;= lv
  -----------------------------
          v := e : lv</code></pre>
<p>An assignment only assigns to one variable, so the most public variable it
assigns to is that variable. To construct an assignment at all, the expression
must be less private than the assigned variable.</p>
<p>This is enough to ban all private data leaking through explicit flows. For
example, the following program is fine because <code>public</code> has a lower security
level (i.e., more public) than <code>private</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>simpleAssignmentOK <span class="ot">=</span> <span class="dt">Program</span> <span class="op">$</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  private <span class="op">:=</span> <span class="dt">EVar</span> public</span></code></pre></div>
<p>However, if we attempt to go in the other direction, we‚Äôll get a type error.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>simpleAssignmentKO <span class="ot">=</span> <span class="dt">Program</span> <span class="op">$</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  public <span class="op">:=</span> <span class="dt">EVar</span> private</span></code></pre></div>
<p>Particularly, GHC has the following to say about this program:</p>
<pre><code>Couldn't match type ‚Äò'False‚Äô with ‚Äò'True‚Äô arising from a use of ‚Äò:=‚Äô</code></pre>
<p>I grant you that this is not the most obvious error message. But at least we
have a compile-time error instead of leaking private data! Substituting the
security levels, we have <code>999 &lt;= 0</code> which is a shorthand for <code>999 &lt;=?  0 ~ True</code>
and GHC simplifies <code>999 &lt;=? 0</code> to <code>False</code>. This is why the error message says
<code>False</code> and <code>True</code> do not match.</p>
<h4 id="sequencing">Sequencing</h4>
<p>The most public variable assigned in a sequence of two commands of course
belongs to the subcommand that has the more public assignment in it.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ot">(:&gt;&gt;) ::</span> <span class="dt">Cmd</span> l1 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l2 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> (<span class="dt">Min</span> l1 l2)</span></code></pre></div>
<p>The equivalent inference rule:</p>
<pre><code>  c1 : l1       c2 : l2
  ---------------------
  c1 :&gt;&gt; c2 : Min l1 l2</code></pre>
<p>Two commands in sequence are well-typed if and only if both of the subcommands
are well-typed. For example, the following sequence of two assignments is
alright.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>tempAssignmentOK <span class="ot">=</span> <span class="dt">Program</span> <span class="op">$</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  temp <span class="op">:=</span> <span class="dt">EVar</span> public <span class="op">:&gt;&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  private <span class="op">:=</span> <span class="dt">EVar</span> temp</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">=</span> <span class="dt">Variable</span> <span class="op">@</span><span class="dv">5</span> <span class="st">&quot;temp&quot;</span></span></code></pre></div>
<p>The security level of the assignments are <code>Min 5 0</code> and <code>Min 999 5</code>, so the
overall security level for the sequenced command is <code>Min 0 5</code> which is just <code>0</code>,
i.e., the security level of <code>public</code>.</p>
<h4 id="if-then-else">If-then-else</h4>
<p>It is time to tackle the more mysterious implicit flows that happen as a result
of a conditional write to some public data based on a private one.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="dt">ITE</span><span class="ot"> ::</span> (lb <span class="op">&lt;=</span> <span class="dt">Min</span> l1 l2) <span class="ot">=&gt;</span> <span class="dt">Exp</span> lb <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l1 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l2 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> (<span class="dt">Min</span> l1 l2)</span></code></pre></div>
<p>The equivalent inference rule:</p>
<pre><code>           e : lb
          c1 : l1
          c2 : l2
      lb &lt;= Min l1 l2
  -----------------------
  ITE e c1 c2 : Min l1 l2</code></pre>
<p>The reasoning for the overall security level of a conditional statement is same
as that for sequencing. The most public level assigned in the overall statement
must come from the more public subcommand. Unlike sequencing, we know that only
one of the branches will be taken but we cannot know which one at compile time,
so we pessimistically account for both cases.</p>
<p>This rule also comes with a requirement that needs to be satisfied. The security
level of the conditional expression (<code>lb</code>) must be less than those of both
branches (<code>l1</code> and <code>l2</code>). This prevents implicit flows and explains why we carry
the security level of the most public security level commands assign to. If the
security level of the condition was higher than the lowest level assigned in one
of the branches, then a more public variable‚Äôs value would be in part determined
by a private one. Thus, by observing the more public value, we could deduce
something about the private value. However, the condition ensures that only more
public data can influence private data. This is safe because whoever has access
to the more private data would also have access to the public one.</p>
<p>The explanation is a mouthful, but examples make the point clearer.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>implicitPublicFlowOK <span class="ot">=</span> <span class="dt">Program</span> <span class="op">$</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ITE</span> (<span class="dt">EVar</span> public)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    (public <span class="op">:=</span> <span class="dt">EInt</span> <span class="dv">42</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    (private <span class="op">:=</span> <span class="dt">EVar</span> public)</span></code></pre></div>
<p>The conditional expression in this program is public. In the then branch, we
assign to <code>public</code> which is always safe. In the else branch, we assign to
<code>private</code>, but this too is fine because if we are allowed to observe <code>private</code>,
we can only make a conclusion about <code>public</code> which we are allowed inspect in
full anyway.</p>
<p>A similar program with the conditional expression changed to <code>private</code>, on the
other hand, fails with the same <code>False</code> is not <code>True</code> error:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>implicitPrivateFlowKO <span class="ot">=</span> <span class="dt">Program</span> <span class="op">$</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ITE</span> (<span class="dt">EVar</span> private)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    (public <span class="op">:=</span> <span class="dt">EInt</span> <span class="dv">42</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    (private <span class="op">:=</span> <span class="dt">EVar</span> public)</span></code></pre></div>
<p>This program is ill-typed because <code>private</code> is more private than <code>public</code>. We
can easily justify this ban. Otherwise, if we observed the value of <code>public</code> not
to be <code>42</code>, we could deduce that the else branch is taken, and consequently,
<code>private</code> must be non-zero. So by observing <code>public</code>, we would have leaked
something about <code>private</code>.</p>
<p>The typing rule for if-then-else statements come with a limitation in
expressiveness. It bans some programs that cannot leak private data.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>implicitPrivateFlowOKKO <span class="ot">=</span> <span class="dt">Program</span> <span class="op">$</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ITE</span> (<span class="dt">EVar</span> private)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    (public <span class="op">:=</span> <span class="dt">EInt</span> <span class="dv">42</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    (public <span class="op">:=</span> <span class="dt">EInt</span> <span class="dv">42</span>)</span></code></pre></div>
<p>This program is illegal according to our typing rules because there is an
implicit flow from security level <code>999</code> to <code>0</code> (in two different ways in fact!),
but this does not actually leak data. By observing the value of <code>public</code> after the
program is executed, we cannot tell anything about <code>private</code> because the
assignment to <code>public</code> is consistent in both branches.</p>
<p>This particular example looks easy to detect, but in general, it requires
program equivalence which would make typechecking undecidable.</p>
<h4 id="while-loop">While loop</h4>
<p>Uncharacteristically, the while loop rule is simpler than the one for
if-then-else statements.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="dt">While</span><span class="ot"> ::</span> (lb <span class="op">&lt;=</span> l) <span class="ot">=&gt;</span> <span class="dt">Exp</span> lb <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l</span></code></pre></div>
<p>The equivalent inference rule:</p>
<pre><code>      e : lb
      c : l
     lb &lt;= l
  -------------
  While e c : l</code></pre>
<p>The minimum assignment level can only come from the only subcommand of the while
loop.</p>
<p>The requirement for constructing a while loop is for the conditional
expression‚Äôs security level to be more public than the most public level
assigned in the loop body. The reasoning is precisely the same as the one for
if-then-else statements.</p>
<p>Now that we have the while loop, let‚Äôs look at the least contrived program of
this post. We halve an even natural number by looping.</p>
<p>Let‚Äôs first derive reusable increment and decrement operations. To do this we
derive a generic <code>adder</code> first.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ot">lemmaMax0 ::</span> <span class="dt">Max</span> level <span class="dv">0</span> <span class="op">:~:</span> level</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>lemmaMax0 <span class="ot">=</span> <span class="dt">Refl</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="ot">adder ::</span> <span class="kw">forall</span> level<span class="op">.</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Variable</span> level <span class="ot">-&gt;</span> <span class="dt">Cmd</span> level</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>adder i var <span class="op">|</span> <span class="dt">Refl</span> <span class="ot">&lt;-</span> lemmaMax0 <span class="op">@</span>level <span class="ot">=</span> var <span class="op">:=</span> <span class="dt">EVar</span> var <span class="op">:+</span> <span class="dt">EInt</span> i</span></code></pre></div>
<p>This looks more complicated than one initially expects. The body of the adder is
simple, we offset the given variable‚Äôs value with <code>i</code> and assign back to the
variable. But what about that <code>lemmaMax0</code> and <code>Refl</code>? Long story short, the
assignment in question does not have access to a concrete level, it works for
any security level, so GHC has to do some symbolic reasoning.</p>
<p>In particular, GHC needs to prove that <code>Max level 0 &lt;= level</code>. This is always
true, but not obvious to GHC. I prove a stronger property in <code>lemmaMax0</code>, namely
<code>Max level 0</code> is exactly <code>level</code>. The proof is by reflexivity. Normally, GHC
cannot recognise this proof on its own, so we‚Äôd need to teach it some
arithmetic, but I felt lazy this weekend and added a typechecker plugin that
lets GHC in on some basic arithmetic facts. Such plugins are incredible, but out
of scope of this post. The plugin I used is
<a href="https://github.com/clash-lang/ghc-typelits-extra">ghc-typelits-extra</a>.</p>
<p>Now that we have this lemma, I simply pattern match on it which simplifies the
<code>Max level 0 &lt;= level</code> proof obligation to <code>level &lt;= level</code> and GHC is clever
enough to work that one out.</p>
<p>After the small detour, the actual increment and decrement operations are
trivial.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>inc,<span class="ot"> dec ::</span> <span class="dt">Variable</span> level <span class="ot">-&gt;</span> <span class="dt">Cmd</span> level</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>inc <span class="ot">=</span> adder <span class="dv">1</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>dec <span class="ot">=</span> adder (<span class="op">-</span><span class="dv">1</span>)</span></code></pre></div>
<p>We are now ready to halve an even natural number stored in <code>privCounter</code> and
store its value in <code>private</code>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>halveCovertKO <span class="ot">=</span> <span class="dt">Program</span> <span class="op">$</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  finished <span class="op">:=</span> <span class="dt">EInt</span> <span class="dv">0</span> <span class="op">:&gt;&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  private <span class="op">:=</span> <span class="dt">EInt</span> <span class="dv">0</span> <span class="op">:&gt;&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">While</span> (<span class="dt">EVar</span> privCounter)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    (dec privCounter <span class="op">:&gt;&gt;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>     dec privCounter <span class="op">:&gt;&gt;</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>     inc private) <span class="op">:&gt;&gt;</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  inc finished</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  finished <span class="ot">=</span> <span class="dt">Variable</span> <span class="op">@</span><span class="dv">0</span> <span class="st">&quot;finished&quot;</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  privCounter <span class="ot">=</span> <span class="dt">Variable</span> <span class="op">@</span><span class="dv">42</span> <span class="st">&quot;privCounter&quot;</span></span></code></pre></div>
<p>The conditional of the while loop is just as private as the variables
incremented and decremented in its body. Hence, the program does not leak
private data, or does it? ü§î</p>
<h2 id="plugging-covert-channels">Plugging covert channels</h2>
<p>The natural number halving program above does not leak data explicitly or
implicitly, but it leaks some data through covert channels. We can observe that
the program terminates because we can observe the value of <code>finished</code> which is
public. Knowing that the program terminated leaks the fact that <code>privCounter</code>‚Äôs
original value was either zero or even. We shouldn‚Äôt be able to deduce that
since this counter is private whereas termination is public.</p>
<p>Fortunately, not all is lost. We can plug this covert channel with a minor
modification to the while constructor.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="dt">While</span><span class="ot"> ::</span> <span class="dt">Exp</span> <span class="dv">0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l</span></code></pre></div>
<p>The equivalent inference rule:</p>
<pre><code>      e : 0
      c : l
  -------------
  While e c : l</code></pre>
<p>This change necessitates the loop‚Äôs conditional expression to be public. It also
dispenses with the conditional expression being more public than the most public
variable assigned in the body because this always holds when the conditional
expression is public.</p>
<p>This easily bars the halving program because it both modifies private variables,
but does it cover all cases of non-termination-based private data leakage? If
the program terminates, we learn that the conditional expression hit zero. This
only tells us about the data involved in that expression, so if all of that is
public anyway, we cannot possibly leak data.</p>
<h3 id="expressivity">Expressivity</h3>
<p>This change, sadly, lands two more blows to expressivity.</p>
<p>First, if we initialise <code>privCounter</code> before the while loop to a positive even
number, the program always terminates and the program cannot leak data. However,
deducing this in general requires a solution to the halting problem.</p>
<p>Second, and more importantly, non-termination can only depend on public data.
For example, if we extended our language with arrays and had an array of
employees, we would wouldn‚Äôt be able to loop over employees if the number of
employees was private.</p>
<p>Our saving grace is that we can get a lot done with terminating programs.
Reassessing the employee example, if we extend our language with <code>foreach</code> and
loop over the array directly, granted that we cannot make the array larger as we
iterate over it, the loop would always terminate. Consequently, <code>foreach</code> admits
a more permissive typing rule without compromising privacy through covert
channels.</p>
<h2 id="final-words">Final words</h2>
<p>The language we considered here is simple, but the literature on type-based
information-flow control is both wide and active. We already talked about how we
can enrich the language with <code>foreach</code> and improve expressivity while being
termination-sensitive. The same trick we used for while loops can also be
applied to exceptions to prevent other covert channels. <a href="https://dl.acm.org/doi/10.1145/1929553.1929564">Language-Based
Information-Flow Security</a> by
Andrei Sabelfeld and Andrew Myers provide a good lay of the land. More
specifically, <a href="https://ieeexplore.ieee.org/document/596807">Eliminating Covert Flows with Minimum
Typings</a> by Volpano and Smith
introduces termination-sensitive typing we presented as well as how to securely
employ exceptions.</p>
<p>The ulterior motive of this post is to show off how seamless type-level
programming in Haskell can be. At no point, I said ‚ÄúI wish I was using a proper
dependently typed language‚Äù to myself. We even avoided reinventing arithmetic
using a typechecker plugin. That topic clearly deserves a post of its own.</p>
<p>You might be bit disappointed if you‚Äôre a Haskell developer looking to employ
static IFC in your code. One remedy might be the <a href="https://hackage.haskell.org/package/lio">LIO monad available in
Hackage</a> which takes a similar approach
but is dynamic. If you‚Äôre after no runtime cost, Chapter 6 of <a href="https://dl.acm.org/doi/10.1145/1929553.1929564">Information Flow
Enforcement in Monadic
Libraries</a> introduces a monad
transformer in Haskell that employs the same ideas presented in this blog post
to statically enforce information-flow properties.</p>
<p>The intuition presented in this blog post about why our type system is
sound is no substitute for a proof. The most beautiful definition that captures
the desired property is called <em>non-interference</em> which simply says private data
does not interfere with public data in a formal manner. This definition is far
reaching because it makes little reference to the dynamic semantics of the
language. That too deserves a thorough treatment of its own. That and the proof
can be found in <a href="https://core.ac.uk/download/pdf/36700757.pdf">A Sound Type System for Secure Flow
Analysis</a> by Volpano, Irvine, and
Smith. This is also the paper that introduced the type system we considered.</p>
<p>Finally and most importantly, the treatment of the type system in this chapter
comes from the Chapter 9 of <a href="http://concrete-semantics.org">Concrete Semantics</a>
by Tobias Nipkow and Gerwin Klein. Not only it is beautifully and inductively
presented, but also the soundness proof of the type system is mechanised in
Isabelle/HOL. All there was left for me was to translate it to Haskell using
GADTs.</p>
<h2 id="inference-rules">Inference rules</h2>
<p>Quick reference for all the inference rules in this post.</p>
<p>Expressions:</p>
<pre><code>                         v : l              e1 : l1      e2 : l2
---------- int        ---------- var        -------------------- add
EInt n : 0            EVar v : l            e1 :+ e2 : max l1 l2</code></pre>
<p>Commands (termination-sensitive):</p>
<pre><code>
v : lv    e : le    le &lt;= lv             c1 : l1       c2 : l2
---------------------------- assign      --------------------- sequence
        v := e : lv                      c1 :&gt;&gt; c2 : Min l1 l2


        e : lb
c1 : l1         c2 : l2                            e : 0
    lb &lt;= Min l1 l2                                c : l
----------------------- if-then-else           ------------- while
ITE e c1 c2 : Min l1 l2                        While e c : l</code></pre>
<h2 id="full-program">Full program</h2>
<p>The full program can be found in <a href="https://github.com/madgen/volpano-smith">this
repository</a>.</p>
<p>The GHC typechecker plugin,
<a href="https://github.com/clash-lang/ghc-typelits-extra">ghc-typelits-extra</a>, is
distributed on <a href="https://hackage.haskell.org/package/ghc-typelits-extra">Hackage</a>
and
<a href="https://www.stackage.org/lts-18.0/package/ghc-typelits-extra-0.4.2">Stackage</a>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# OPTIONS_GHC -fplugin GHC.TypeLits.Extra.Solver #-}</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE KindSignatures #-}</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE DataKinds #-}</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE GADTs #-}</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE TypeOperators #-}</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE TypeApplications #-}</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE ScopedTypeVariables #-}</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="dt">VolpanoSmith</span> <span class="kw">where</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">GHC.TypeLits</span> (<span class="dt">Nat</span>, type (&lt;=))</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">GHC.TypeLits.Extra</span> (<span class="dt">Max</span>, <span class="dt">Min</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.Kind</span> (<span class="dt">Type</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.Data</span> (type (:~:)(<span class="dt">Refl</span>))</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co">--------------------------------------------------------------------------------</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co">-- Basic language without Information-Flow Security enforcement</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co">--------------------------------------------------------------------------------</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="kw">newtype</span> <span class="dt">Variable0</span> <span class="ot">=</span> <span class="dt">Variable0</span> <span class="dt">String</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="kw">infixr</span> <span class="dv">6</span> <span class="op">:+.</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Exp0</span> <span class="kw">where</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">EInt0</span><span class="ot"> ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Exp0</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">EVar0</span><span class="ot"> ::</span> <span class="dt">Variable0</span> <span class="ot">-&gt;</span> <span class="dt">Exp0</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="ot">  (:+.) ::</span> <span class="dt">Exp0</span> <span class="ot">-&gt;</span> <span class="dt">Exp0</span> <span class="ot">-&gt;</span> <span class="dt">Exp0</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="kw">infixl</span> <span class="dv">5</span> <span class="op">:=.</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="kw">infixl</span> <span class="dv">4</span> <span class="op">:&gt;&gt;.</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Cmd0</span> <span class="kw">where</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="ot">  (:=.)  ::</span> <span class="dt">Variable0</span> <span class="ot">-&gt;</span> <span class="dt">Exp0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd0</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="ot">  (:&gt;&gt;.) ::</span> <span class="dt">Cmd0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd0</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ITE0</span><span class="ot">   ::</span> <span class="dt">Exp0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd0</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>  <span class="dt">While0</span><span class="ot"> ::</span> <span class="dt">Exp0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd0</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">Program0</span> <span class="ot">=</span> <span class="dt">Cmd0</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a><span class="ot">simpleProgram ::</span> <span class="dt">Program0</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>simpleProgram <span class="ot">=</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>  x <span class="op">:=.</span> <span class="dt">EInt0</span> <span class="dv">42</span> <span class="op">:&gt;&gt;.</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ITE0</span> (<span class="dt">EVar0</span> x)</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>    (<span class="dt">While0</span> (<span class="dt">EVar0</span> y) <span class="op">$</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>      y <span class="op">:=.</span> <span class="dt">EVar0</span> y <span class="op">:+.</span> <span class="dt">EInt0</span> (<span class="op">-</span><span class="dv">1</span>) <span class="op">:&gt;&gt;.</span></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>      x <span class="op">:=.</span> <span class="dt">EVar0</span> x <span class="op">:+.</span> <span class="dt">EInt0</span> <span class="dv">1</span>)</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>    (y <span class="op">:=.</span> <span class="dt">EInt0</span> <span class="dv">24</span>)</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="dt">Variable0</span> <span class="st">&quot;x&quot;</span></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">=</span> <span class="dt">Variable0</span> <span class="st">&quot;y&quot;</span></span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a><span class="co">--------------------------------------------------------------------------------</span></span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a><span class="co">-- Privacy enforcing programs</span></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a><span class="co">--------------------------------------------------------------------------------</span></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">Level</span> <span class="ot">=</span> <span class="dt">Nat</span></span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a><span class="kw">newtype</span> <span class="dt">Variable</span> (<span class="ot">l ::</span> <span class="dt">Level</span>) <span class="ot">=</span> <span class="dt">Variable</span> <span class="dt">String</span></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a><span class="kw">infixr</span> <span class="dv">6</span> <span class="op">:+</span></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Exp</span> (<span class="ot">level ::</span> <span class="dt">Level</span>) <span class="kw">where</span></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>  <span class="dt">EInt</span><span class="ot">  ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Exp</span> <span class="dv">0</span></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>  <span class="dt">EVar</span><span class="ot">  ::</span> <span class="dt">Variable</span> level <span class="ot">-&gt;</span> <span class="dt">Exp</span> level</span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a><span class="ot">  (:+) ::</span> <span class="dt">Exp</span> level1 <span class="ot">-&gt;</span> <span class="dt">Exp</span> level2 <span class="ot">-&gt;</span> <span class="dt">Exp</span> (<span class="dt">Max</span> level1 level2)</span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a><span class="kw">infixl</span> <span class="dv">5</span> <span class="op">:=</span></span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a><span class="kw">infixl</span> <span class="dv">4</span> <span class="op">:&gt;&gt;</span></span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Cmd</span> (<span class="ot">level ::</span> <span class="dt">Level</span>) <span class="kw">where</span></span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a><span class="ot">  (:=)  ::</span> (le <span class="op">&lt;=</span> lx) <span class="ot">=&gt;</span> <span class="dt">Variable</span> lx <span class="ot">-&gt;</span> <span class="dt">Exp</span> le <span class="ot">-&gt;</span> <span class="dt">Cmd</span> lx</span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a><span class="ot">  (:&gt;&gt;) ::</span> <span class="dt">Cmd</span> l1 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l2 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> (<span class="dt">Min</span> l1 l2)</span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ITE</span><span class="ot">   ::</span> (lb <span class="op">&lt;=</span> <span class="dt">Min</span> l1 l2) <span class="ot">=&gt;</span> <span class="dt">Exp</span> lb <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l1 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l2 <span class="ot">-&gt;</span> <span class="dt">Cmd</span> (<span class="dt">Min</span> l1 l2)</span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>  <span class="dt">While</span><span class="ot"> ::</span> (lb <span class="op">&lt;=</span> l) <span class="ot">=&gt;</span> <span class="dt">Exp</span> lb <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l <span class="ot">-&gt;</span> <span class="dt">Cmd</span> l</span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Program</span> (<span class="ot">cmd ::</span> <span class="dt">Level</span> <span class="ot">-&gt;</span> <span class="dt">Type</span>) <span class="ot">=</span> <span class="kw">forall</span> l<span class="op">.</span> <span class="dt">Program</span> (cmd l)</span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a><span class="co">--------------------------------------------------------------------------------</span></span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a><span class="co">-- Example programs</span></span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a><span class="co">--------------------------------------------------------------------------------</span></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a><span class="ot">public ::</span> <span class="dt">Variable</span> <span class="dv">0</span></span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a>public <span class="ot">=</span> <span class="dt">Variable</span> <span class="st">&quot;public&quot;</span></span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a><span class="ot">private ::</span> <span class="dt">Variable</span> <span class="dv">999</span></span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a>private <span class="ot">=</span> <span class="dt">Variable</span> <span class="st">&quot;private&quot;</span></span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a><span class="ot">compoundPrivateExp ::</span> <span class="dt">Exp</span> <span class="dv">999</span></span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a>compoundPrivateExp <span class="ot">=</span> <span class="dt">EVar</span> public <span class="op">:+</span> <span class="dt">EVar</span> private</span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a><span class="ot">simpleAssignmentOK ::</span> <span class="dt">Program</span> <span class="dt">Cmd</span></span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a>simpleAssignmentOK <span class="ot">=</span> <span class="dt">Program</span> <span class="op">$</span></span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a>  private <span class="op">:=</span> <span class="dt">EVar</span> public</span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a>  <span class="co">{-</span></span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a><span class="co">simpleAssignmentKO :: Program Cmd</span></span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a><span class="co">simpleAssignmentKO = Program $</span></span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a><span class="co">  public := EVar private</span></span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a><span class="co">  -}</span></span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a><span class="ot">tempAssignmentOK ::</span> <span class="dt">Program</span> <span class="dt">Cmd</span></span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a>tempAssignmentOK <span class="ot">=</span> <span class="dt">Program</span> <span class="op">$</span></span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a>  temp <span class="op">:=</span> <span class="dt">EVar</span> public <span class="op">:&gt;&gt;</span></span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a>  private <span class="op">:=</span> <span class="dt">EVar</span> temp</span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">=</span> <span class="dt">Variable</span> <span class="op">@</span><span class="dv">5</span> <span class="st">&quot;temp&quot;</span></span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a><span class="ot">implicitPublicFlowOK ::</span> <span class="dt">Program</span> <span class="dt">Cmd</span></span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a>implicitPublicFlowOK <span class="ot">=</span> <span class="dt">Program</span> <span class="op">$</span></span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ITE</span> (<span class="dt">EVar</span> public)</span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a>    (public <span class="op">:=</span> <span class="dt">EInt</span> <span class="dv">42</span>)</span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a>    (private <span class="op">:=</span> <span class="dt">EVar</span> public)</span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a>  <span class="co">{-</span></span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a><span class="co">implicitPrivateFlowKO :: Program Cmd</span></span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a><span class="co">implicitPrivateFlowKO = Program $</span></span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a><span class="co">  ITE (EVar private)</span></span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a><span class="co">    (public := EInt 42)</span></span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a><span class="co">    (private := EVar public)</span></span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a><span class="co">  -}</span></span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a>  <span class="co">{-</span></span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a><span class="co">implicitPrivateFlowOKKO :: Program Cmd</span></span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a><span class="co">implicitPrivateFlowOKKO = Program $</span></span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a><span class="co">  ITE (EVar private)</span></span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a><span class="co">    (public := EInt 42)</span></span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a><span class="co">    (public := EInt 42)</span></span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a><span class="co">  -}</span></span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a><span class="ot">implicitPrivateFlowOK ::</span> <span class="dt">Program</span> <span class="dt">Cmd</span></span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a>implicitPrivateFlowOK <span class="ot">=</span> <span class="dt">Program</span> <span class="op">$</span></span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ITE</span> (<span class="dt">EVar</span> private)</span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a>    (private <span class="op">:=</span> <span class="dt">EInt</span> <span class="dv">42</span>)</span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a>    (private <span class="op">:=</span> <span class="dt">EVar</span> public)</span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a><span class="ot">lemmaMax0 ::</span> <span class="dt">Max</span> level <span class="dv">0</span> <span class="op">:~:</span> level</span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true" tabindex="-1"></a>lemmaMax0 <span class="ot">=</span> <span class="dt">Refl</span></span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a><span class="ot">adder ::</span> <span class="kw">forall</span> level<span class="op">.</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Variable</span> level <span class="ot">-&gt;</span> <span class="dt">Cmd</span> level</span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a>adder i var <span class="op">|</span> <span class="dt">Refl</span> <span class="ot">&lt;-</span> lemmaMax0 <span class="op">@</span>level <span class="ot">=</span> var <span class="op">:=</span> <span class="dt">EVar</span> var <span class="op">:+</span> <span class="dt">EInt</span> i</span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a>inc,<span class="ot"> dec ::</span> <span class="dt">Variable</span> level <span class="ot">-&gt;</span> <span class="dt">Cmd</span> level</span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a>inc <span class="ot">=</span> adder <span class="dv">1</span></span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a>dec <span class="ot">=</span> adder (<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a><span class="ot">halveOK ::</span> <span class="dt">Program</span> <span class="dt">Cmd</span></span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a>halveOK <span class="ot">=</span> <span class="dt">Program</span> <span class="op">$</span></span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a>  finished <span class="op">:=</span> <span class="dt">EInt</span> <span class="dv">0</span> <span class="op">:&gt;&gt;</span></span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a>  public <span class="op">:=</span> <span class="dt">EInt</span> <span class="dv">42</span> <span class="op">:&gt;&gt;</span></span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a>  <span class="dt">While</span> (<span class="dt">EVar</span> pubCounter)</span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a>    (dec pubCounter <span class="op">:&gt;&gt;</span></span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a>     dec pubCounter <span class="op">:&gt;&gt;</span></span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a>     inc public) <span class="op">:&gt;&gt;</span></span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a>  inc finished</span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a>  finished <span class="ot">=</span> <span class="dt">Variable</span> <span class="op">@</span><span class="dv">0</span> <span class="st">&quot;finished&quot;</span></span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true" tabindex="-1"></a>  pubCounter <span class="ot">=</span> <span class="dt">Variable</span> <span class="op">@</span><span class="dv">0</span> <span class="st">&quot;pubCounter&quot;</span></span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true" tabindex="-1"></a><span class="ot">halveCovertKO ::</span> <span class="dt">Program</span> <span class="dt">Cmd</span></span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true" tabindex="-1"></a>halveCovertKO <span class="ot">=</span> <span class="dt">Program</span> <span class="op">$</span></span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a>  finished <span class="op">:=</span> <span class="dt">EInt</span> <span class="dv">0</span> <span class="op">:&gt;&gt;</span></span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a>  private <span class="op">:=</span> <span class="dt">EInt</span> <span class="dv">42</span> <span class="op">:&gt;&gt;</span></span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a>  <span class="dt">While</span> (<span class="dt">EVar</span> privCounter)</span>
<span id="cb35-161"><a href="#cb35-161" aria-hidden="true" tabindex="-1"></a>    (dec privCounter <span class="op">:&gt;&gt;</span></span>
<span id="cb35-162"><a href="#cb35-162" aria-hidden="true" tabindex="-1"></a>     dec privCounter <span class="op">:&gt;&gt;</span></span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a>     inc private) <span class="op">:&gt;&gt;</span></span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a>  inc finished</span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a>  finished <span class="ot">=</span> <span class="dt">Variable</span> <span class="op">@</span><span class="dv">0</span> <span class="st">&quot;finished&quot;</span></span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a>  privCounter <span class="ot">=</span> <span class="dt">Variable</span> <span class="op">@</span><span class="dv">42</span> <span class="st">&quot;privCounter&quot;</span></span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true" tabindex="-1"></a><span class="co">--------------------------------------------------------------------------------</span></span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a><span class="co">-- Termination-sensitive privacy enforcing programs</span></span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a><span class="co">--------------------------------------------------------------------------------</span></span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a><span class="kw">infixl</span> <span class="dv">5</span> <span class="op">:==</span></span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a><span class="kw">infixl</span> <span class="dv">4</span> <span class="op">:&gt;&gt;&gt;</span></span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Cmd'</span> (<span class="ot">level ::</span> <span class="dt">Level</span>) <span class="kw">where</span></span>
<span id="cb35-176"><a href="#cb35-176" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Skip'</span><span class="ot">  ::</span> <span class="dt">Cmd'</span> level</span>
<span id="cb35-177"><a href="#cb35-177" aria-hidden="true" tabindex="-1"></a><span class="ot">  (:==)  ::</span> (le <span class="op">&lt;=</span> lx) <span class="ot">=&gt;</span> <span class="dt">Variable</span> lx <span class="ot">-&gt;</span> <span class="dt">Exp</span> le <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> lx</span>
<span id="cb35-178"><a href="#cb35-178" aria-hidden="true" tabindex="-1"></a><span class="ot">  (:&gt;&gt;&gt;) ::</span> <span class="dt">Cmd'</span> l1 <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> l2 <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> (<span class="dt">Min</span> l1 l2)</span>
<span id="cb35-179"><a href="#cb35-179" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ITE'</span><span class="ot">   ::</span> (lb <span class="op">&lt;=</span> <span class="dt">Min</span> l1 l2) <span class="ot">=&gt;</span> <span class="dt">Exp</span> lb <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> l1 <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> l2 <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> (<span class="dt">Min</span> l1 l2)</span>
<span id="cb35-180"><a href="#cb35-180" aria-hidden="true" tabindex="-1"></a>  <span class="dt">While'</span><span class="ot"> ::</span> <span class="dt">Exp</span> <span class="dv">0</span> <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> l <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> l</span>
<span id="cb35-181"><a href="#cb35-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-182"><a href="#cb35-182" aria-hidden="true" tabindex="-1"></a><span class="ot">adder' ::</span> <span class="kw">forall</span> level<span class="op">.</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Variable</span> level <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> level</span>
<span id="cb35-183"><a href="#cb35-183" aria-hidden="true" tabindex="-1"></a>adder' i var <span class="op">|</span> <span class="dt">Refl</span> <span class="ot">&lt;-</span> lemmaMax0 <span class="op">@</span>level <span class="ot">=</span> var <span class="op">:==</span> <span class="dt">EVar</span> var <span class="op">:+</span> <span class="dt">EInt</span> i</span>
<span id="cb35-184"><a href="#cb35-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-185"><a href="#cb35-185" aria-hidden="true" tabindex="-1"></a>inc',<span class="ot"> dec' ::</span> <span class="dt">Variable</span> level <span class="ot">-&gt;</span> <span class="dt">Cmd'</span> level</span>
<span id="cb35-186"><a href="#cb35-186" aria-hidden="true" tabindex="-1"></a>inc' <span class="ot">=</span> adder' <span class="dv">1</span></span>
<span id="cb35-187"><a href="#cb35-187" aria-hidden="true" tabindex="-1"></a>dec' <span class="ot">=</span> adder' (<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb35-188"><a href="#cb35-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-189"><a href="#cb35-189" aria-hidden="true" tabindex="-1"></a><span class="ot">halveOK' ::</span> <span class="dt">Program</span> <span class="dt">Cmd'</span></span>
<span id="cb35-190"><a href="#cb35-190" aria-hidden="true" tabindex="-1"></a>halveOK' <span class="ot">=</span> <span class="dt">Program</span> <span class="op">$</span></span>
<span id="cb35-191"><a href="#cb35-191" aria-hidden="true" tabindex="-1"></a>  finished <span class="op">:==</span> <span class="dt">EInt</span> <span class="dv">0</span> <span class="op">:&gt;&gt;&gt;</span></span>
<span id="cb35-192"><a href="#cb35-192" aria-hidden="true" tabindex="-1"></a>  private <span class="op">:==</span> <span class="dt">EInt</span> <span class="dv">0</span> <span class="op">:&gt;&gt;&gt;</span></span>
<span id="cb35-193"><a href="#cb35-193" aria-hidden="true" tabindex="-1"></a>  <span class="dt">While'</span> (<span class="dt">EVar</span> pubCounter)</span>
<span id="cb35-194"><a href="#cb35-194" aria-hidden="true" tabindex="-1"></a>    (dec' pubCounter <span class="op">:&gt;&gt;&gt;</span></span>
<span id="cb35-195"><a href="#cb35-195" aria-hidden="true" tabindex="-1"></a>     dec' pubCounter <span class="op">:&gt;&gt;&gt;</span></span>
<span id="cb35-196"><a href="#cb35-196" aria-hidden="true" tabindex="-1"></a>     inc' private) <span class="op">:&gt;&gt;&gt;</span></span>
<span id="cb35-197"><a href="#cb35-197" aria-hidden="true" tabindex="-1"></a>  inc' finished</span>
<span id="cb35-198"><a href="#cb35-198" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb35-199"><a href="#cb35-199" aria-hidden="true" tabindex="-1"></a>  finished <span class="ot">=</span> <span class="dt">Variable</span> <span class="op">@</span><span class="dv">0</span> <span class="st">&quot;finished&quot;</span></span>
<span id="cb35-200"><a href="#cb35-200" aria-hidden="true" tabindex="-1"></a>  pubCounter <span class="ot">=</span> <span class="dt">Variable</span> <span class="op">@</span><span class="dv">0</span> <span class="st">&quot;pubCounter&quot;</span></span>
<span id="cb35-201"><a href="#cb35-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-202"><a href="#cb35-202" aria-hidden="true" tabindex="-1"></a>  <span class="co">{-</span></span>
<span id="cb35-203"><a href="#cb35-203" aria-hidden="true" tabindex="-1"></a><span class="co">halveCovertKO' :: Program Cmd'</span></span>
<span id="cb35-204"><a href="#cb35-204" aria-hidden="true" tabindex="-1"></a><span class="co">halveCovertKO' = Program $</span></span>
<span id="cb35-205"><a href="#cb35-205" aria-hidden="true" tabindex="-1"></a><span class="co">  finished :== EInt 0 :&gt;&gt;&gt;</span></span>
<span id="cb35-206"><a href="#cb35-206" aria-hidden="true" tabindex="-1"></a><span class="co">  private :== EInt 0 :&gt;&gt;&gt;</span></span>
<span id="cb35-207"><a href="#cb35-207" aria-hidden="true" tabindex="-1"></a><span class="co">  While' (EVar privCounter)</span></span>
<span id="cb35-208"><a href="#cb35-208" aria-hidden="true" tabindex="-1"></a><span class="co">    (dec' privCounter :&gt;&gt;&gt;</span></span>
<span id="cb35-209"><a href="#cb35-209" aria-hidden="true" tabindex="-1"></a><span class="co">     dec' privCounter :&gt;&gt;&gt;</span></span>
<span id="cb35-210"><a href="#cb35-210" aria-hidden="true" tabindex="-1"></a><span class="co">     inc' private) :&gt;&gt;&gt;</span></span>
<span id="cb35-211"><a href="#cb35-211" aria-hidden="true" tabindex="-1"></a><span class="co">  inc' finished</span></span>
<span id="cb35-212"><a href="#cb35-212" aria-hidden="true" tabindex="-1"></a><span class="co">  where</span></span>
<span id="cb35-213"><a href="#cb35-213" aria-hidden="true" tabindex="-1"></a><span class="co">  finished = Variable @0 &quot;finished&quot;</span></span>
<span id="cb35-214"><a href="#cb35-214" aria-hidden="true" tabindex="-1"></a><span class="co">  privCounter = Variable @42 &quot;privCounter&quot;</span></span>
<span id="cb35-215"><a href="#cb35-215" aria-hidden="true" tabindex="-1"></a><span class="co">  -}</span></span>
<span id="cb35-216"><a href="#cb35-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-217"><a href="#cb35-217" aria-hidden="true" tabindex="-1"></a>  <span class="co">{-</span></span>
<span id="cb35-218"><a href="#cb35-218" aria-hidden="true" tabindex="-1"></a><span class="co">halveCovertOKKO :: Program Cmd'</span></span>
<span id="cb35-219"><a href="#cb35-219" aria-hidden="true" tabindex="-1"></a><span class="co">halveCovertOKKO = Program $</span></span>
<span id="cb35-220"><a href="#cb35-220" aria-hidden="true" tabindex="-1"></a><span class="co">  privCounter :== EInt 42 :&gt;&gt;&gt;</span></span>
<span id="cb35-221"><a href="#cb35-221" aria-hidden="true" tabindex="-1"></a><span class="co">  finished :== EInt 0 :&gt;&gt;&gt;</span></span>
<span id="cb35-222"><a href="#cb35-222" aria-hidden="true" tabindex="-1"></a><span class="co">  private :== EInt 0 :&gt;&gt;&gt;</span></span>
<span id="cb35-223"><a href="#cb35-223" aria-hidden="true" tabindex="-1"></a><span class="co">  While' (EVar privCounter)</span></span>
<span id="cb35-224"><a href="#cb35-224" aria-hidden="true" tabindex="-1"></a><span class="co">    (dec' privCounter :&gt;&gt;&gt;</span></span>
<span id="cb35-225"><a href="#cb35-225" aria-hidden="true" tabindex="-1"></a><span class="co">     dec' privCounter :&gt;&gt;&gt;</span></span>
<span id="cb35-226"><a href="#cb35-226" aria-hidden="true" tabindex="-1"></a><span class="co">     inc' private) :&gt;&gt;&gt;</span></span>
<span id="cb35-227"><a href="#cb35-227" aria-hidden="true" tabindex="-1"></a><span class="co">  inc' finished</span></span>
<span id="cb35-228"><a href="#cb35-228" aria-hidden="true" tabindex="-1"></a><span class="co">  where</span></span>
<span id="cb35-229"><a href="#cb35-229" aria-hidden="true" tabindex="-1"></a><span class="co">  finished = Variable @0 &quot;finished&quot;</span></span>
<span id="cb35-230"><a href="#cb35-230" aria-hidden="true" tabindex="-1"></a><span class="co">  privCounter = Variable @42 &quot;privCounter&quot;</span></span>
<span id="cb35-231"><a href="#cb35-231" aria-hidden="true" tabindex="-1"></a><span class="co">  -}</span></span></code></pre></div></div>

<script>
var figures =
  Array.prototype.slice.call(document.getElementsByClassName("figure"),0)
  .concat(
    Array.prototype.slice.call(document.getElementsByTagName("figure"),0));

for (var i = 0; i < figures.length; i++) {
  var figure = figures[i];
  var imgs = figure.getElementsByTagName("img");
  if (imgs.length > 0) {
    classes = imgs[0].classList;
    for (var j = 0; j < classes.length; j++) {
      figure.classList.add(classes[j] + "-figure");
    }
  }
}
</script>

        </div>
        <div id="footer">
          <div class="top-container">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
          </div>
        </div>
    </body>
</html>
